<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é—»äººçš„æŠ€æœ¯åšå®¢</title>
<meta name="description" content="åšä¸€ä¸ªç»ˆç”Ÿå­¦ä¹ çš„æŠ€æœ¯äºº" />
<link rel="shortcut icon" href="https://wrcj12138aaa.github.io//favicon.ico?v=1573963101677">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link href="https://cdn.remixicon.com/releases/v1.3.1/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">

<link rel="stylesheet" href="https://wrcj12138aaa.github.io//styles/main.css">
<link rel="alternate" type="application/atom+xml" title="é—»äººçš„æŠ€æœ¯åšå®¢ - Atom Feed" href="https://wrcj12138aaa.github.io//atom.xml">



  </head>
  <body>
    <div id="app" class="main px-4 flex flex-col lg:flex-row">
      <div id="sidebar" class="sidebar-wrapper lg:static lg:w-1/4">
  <div class="lg:sticky top-0">
    <div class="sidebar-content">
      <div class="flex lg:block p-4 lg:px-0 items-center fixed lg:static lg:block top-0 right-0 left-0 bg-white z-50">
        <i class="remixicon-menu-2-line lg:mt-4 text-2xl cursor-pointer animated fadeIn" onclick="openMenu()"></i>
        <a href="https://wrcj12138aaa.github.io/">
          <img class="animated fadeInLeft avatar rounded-lg mx-4 lg:mt-32 lg:mx-0 mt-0 lg:w-24 lg:h-24 w-12 w-12" src="https://wrcj12138aaa.github.io//images/avatar.png?v=1573963101677" alt="">
        </a>
        <h1 class="animated fadeInLeft lg:text-4xl font-extrabold lg:mt-8 mt-0 text-xl" style="animation-delay: 0.2s">é—»äººçš„æŠ€æœ¯åšå®¢</h1>
      </div>
      
        <div class="animated fadeInLeft" style="animation-delay: 0.4s">
          <p class="my-4 text-gray-600 font-light hidden lg:block">
            æ–‡ç« ç›®å½•
          </p>
          <div class="toc-container hidden lg:block">
            <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%89%8D%E8%A8%80">å‰è¨€</a></li>
<li><a href="#%E8%AE%A4%E8%AF%86-resttemplate">è®¤è¯† <code>RestTemplate</code></a></li>
<li><a href="#%E5%AE%9E%E6%88%98-resttemplate">å®æˆ˜ <code>RestTemplate</code></a>
<ul>
<li><a href="#1-%E7%94%9F%E6%88%90-demo-%E9%A1%B9%E7%9B%AE%E5%AF%BC%E5%85%A5-ide">1. ç”Ÿæˆ Demo é¡¹ç›®ï¼Œå¯¼å…¥ IDE</a></li>
<li><a href="#2-%E7%BC%96%E5%86%99%E8%AF%B7%E6%B1%82%E6%8E%A7%E5%88%B6%E5%99%A8%E7%B1%BB-productcontroller">2. ç¼–å†™è¯·æ±‚æ§åˆ¶å™¨ç±» ProductController</a></li>
<li><a href="#3-%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%B1%BB%E7%94%A8-resttemplate-%E5%8F%91%E9%80%81-http-%E8%AF%B7%E6%B1%82">3. ç¼–å†™æµ‹è¯•ç±»ç”¨ RestTemplate å‘é€ HTTP è¯·æ±‚</a>
<ul>
<li><a href="#get-%E8%AF%B7%E6%B1%82">GET è¯·æ±‚</a></li>
<li><a href="#post-%E8%AF%B7%E6%B1%82">POST è¯·æ±‚</a></li>
<li><a href="#delete-%E8%AF%B7%E6%B1%82-%E5%92%8C-put-%E8%AF%B7%E6%B1%82">DELETE è¯·æ±‚ å’Œ PUT è¯·æ±‚</a></li>
</ul>
</li>
<li><a href="#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6">ä¸Šä¼ æ–‡ä»¶</a></li>
</ul>
</li>
<li><a href="#%E8%BF%9B%E9%98%B6-resttemplate">è¿›é˜¶ RestTemplate</a>
<ul>
<li><a href="#%E5%BA%95%E5%B1%82-http-%E8%AF%B7%E6%B1%82%E5%BA%93%E5%88%87%E6%8D%A2">åº•å±‚ HTTP è¯·æ±‚åº“åˆ‡æ¢</a></li>
<li><a href="#%E8%AF%B7%E6%B1%82%E8%B6%85%E6%97%B6%E8%AE%BE%E7%BD%AE">è¯·æ±‚è¶…æ—¶è®¾ç½®</a></li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      
    </div>
  </div>
</div>

<div class="menu-container">
  <i class="remixicon-arrow-left-line text-2xl cursor-pointer animated fadeIn close-menu-btn" onclick="closeMenu()"></i>
  <div>
    
      
        <a href="/" class="menu" style="animation-delay: 0s">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu" style="animation-delay: 0.2s">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu" style="animation-delay: 0.4s">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu" style="animation-delay: 0.6000000000000001s">
          å…³äº
        </a>
      
    
  </div>
  <div class="site-footer">
    <div class="py-4 text-gray-700"></div>
    <a class="rss" href="https://wrcj12138aaa.github.io//atom.xml" target="_blank">RSS</a>
  </div>
</div>
<div class="mask" onclick="closeMenu()">
</div>
      <div class="content-wrapper py-32 lg:p-8 lg:w-3/4 post-detail animated fadeIn">
        <h1 class="text-3xl font-bold lg:mt-16">ä¸€èµ·å­¦ Spring ä¹‹ RestTemplate</h1>
        <div class="text-sm text-gray-700 lg:my-8">
          2019-05-11 / 21 min read
        </div>
        
        <div class="post-content yue">
          <h2 id="å‰è¨€">å‰è¨€</h2>
<p>åœ¨ Java æœåŠ¡ç«¯å¼€å‘é¢†åŸŸé‡Œï¼ŒSpring æ˜¯ç»•ä¸å¼€çš„è¯é¢˜ï¼Œå°¤å…¶æ˜¯ç°åœ¨å¾®æœåŠ¡æ¦‚å¿µç››è¡Œï¼ŒSpring Boot çš„å‡ºç°æ›´æ˜¯ç»™ Spring æ³¨å…¥äº†æ–°çš„æ´»åŠ›ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ Spring Cloudï¼Œè¿™äº›æ¡†æ¶è®© Spring æŠ€æœ¯ä½“ç³»æ›´åŠ ä¸°å¯Œã€‚Spring ä» 2014 å¹´çš„ 1.0.0 ç‰ˆæœ¬è¿­ä»£åˆ° ç°åœ¨çš„ 5.2.0 M1 ç‰ˆæœ¬ï¼Œç´§éšç€ Java è¯­è¨€å‘å±•ï¼Œä¸æ–­å¼•å…¥æ–°çš„ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚æœ¬æ–‡å…³æ³¨çš„æ˜¯ Spring æ¡†æ¶ä¸­ <code>RestTemplate</code> å†…å®¹ï¼Œå¯ä»¥å‡å°‘æˆ‘ä»¬å¹³æ—¶å¼€å‘å¸¸ä½¿ç”¨çš„ <code>HttpClient</code> API ä¾èµ–ã€‚æ–‡ç« æ‰€æ¶‰åŠçš„ç¤ºä¾‹ Demo è¯¦è§Github åœ°å€ï¼š<a href="https://github.com/wrcj12138aaa/resttemplate/tree/master" title="Resttemplate demo">Resttemplate demo</a> ã€‚æ„Ÿè°¢å°ä¸ƒåŒå­¦çš„è®¤çœŸæ ¡å¯¹ï¼Œå¦‚æœæœ‰ä»»ä½•æŠ€æœ¯é—®é¢˜æˆ–è€…æ–‡ç« çº°æ¼ï¼Œæ¬¢è¿ç•™è¨€è”ç³»ï¼Œä¸€èµ·äº¤æµæ¢è®¨ ğŸ˜ã€‚</p>
<!-- more -->
<h2 id="è®¤è¯†-resttemplate">è®¤è¯† <code>RestTemplate</code></h2>
<p>é¦–å…ˆåœ¨æˆ‘ä»¬å­¦ä¹ ä½¿ç”¨ <code>RestTemplate</code> ä¹‹å‰ï¼Œå…ˆè®¤è¯†ä¸‹è¿™ä¸ªç±»ï¼Œæ¥çœ‹ Spring å®˜æ–¹æ€ä¹ˆæè¿°çš„ã€‚<br>
ä»å®˜æ–¹ API æ–‡æ¡£ <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html" title="resttemplate javadoc">RestTemplate javadoc</a> å¯ä»¥æ‰¾è¯¥ç±»çš„æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Synchronous client to perform HTTP requests, exposing a simple, template method API over underlying HTTP client libraries such as the JDK HttpURLConnection, Apache HttpComponents, and others.<br>
The RestTemplate offers templates for common scenarios by HTTP method, in addition to the generalized exchange and execute methods that support of less frequent cases.</p>
</blockquote>
<p>ä»è¿™é‡Œå¯ä»¥æ¸…æ¥šåœ°äº†è§£åˆ° <code>RestTemplate</code> é‡‡ç”¨åŒæ­¥æ–¹å¼æ‰§è¡Œ HTTP è¯·æ±‚çš„ç±»ï¼Œåº•å±‚ä½¿ç”¨ JDK åŸç”Ÿ <code>HttpURLConnection</code> API ï¼Œæˆ–è€… <code>HttpComponents</code>ç­‰å…¶ä»– HTTP å®¢æˆ·ç«¯è¯·æ±‚ç±»åº“ã€‚è¿˜æœ‰ä¸€å¤„å¼ºè°ƒçš„å°±æ˜¯ <code>RestTemplate</code> æä¾›æ¨¡æ¿åŒ–çš„æ–¹æ³•è®©å¼€å‘è€…èƒ½æ›´ç®€å•åœ°å‘é€ HTTP è¯·æ±‚ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>RestTemplate</code> ç±»æ˜¯åœ¨ Spring Framework 3.0 å¼€å§‹å¼•å…¥çš„ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„ Spring ç‰ˆæœ¬ä¸ºå½“å‰æœ€æ–°çš„ GA ç‰ˆæœ¬ 5.1.6ã€‚è€Œåœ¨ 5.0 ä»¥ä¸Šï¼Œå®˜æ–¹æ ‡æ³¨äº†æ›´æ¨èä½¿ç”¨éé˜»å¡çš„å“åº”å¼ HTTP è¯·æ±‚å¤„ç†ç±» <code>org.springframework.web.reactive.client.WebClient</code> æ¥æ›¿ä»£ <code>RestTemplate</code>ï¼Œå°¤å…¶æ˜¯å¯¹åº”å¼‚æ­¥è¯·æ±‚å¤„ç†çš„åœºæ™¯ä¸Š ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å…ˆç®€å•æ€»ç»“ä¸‹ä»€ä¹ˆæ˜¯ <code>RestTemplate</code> ï¼š <code>RestTemplate</code> å°±æ˜¯ Spring å°è£…çš„å¤„ç†åŒæ­¥ HTTP è¯·æ±‚çš„ç±»ã€‚å…·ä½“å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç±»è¿›è¡Œ HTTP è¯·æ±‚æ“ä½œï¼Œå¯è§æ–‡ç« çš„å®æˆ˜éƒ¨åˆ†ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹ <code>RestTemplate</code> ç±»æä¾›çš„ API æœ‰å“ªäº›,<code>RestTemplate</code> æä¾›äº†å°†è¿‘ 30 ä¸ªè¯·æ±‚æ–¹æ³•ï¼Œå…¶ä¸­å¤šæ•°æ˜¯å•ä¸ªæ–¹æ³•é‡è½½å®ç°ï¼Œè¿™é‡Œæˆ‘ä¸»è¦å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/integration.html#rest-client-access" title="rest-client-access">rest-client-access</a> è¿›è¡Œå¦‚ä¸‹åˆ†ç±»ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•å</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getForObject</code></td>
<td>é€šè¿‡ GET è¯·æ±‚è·å¾—å“åº”ç»“æœ</td>
</tr>
<tr>
<td><code>getForEntity</code></td>
<td>é€šè¿‡ GET è¯·æ±‚è·å– <code>ResponseEntity</code> å¯¹è±¡ï¼ŒåŒ…å®¹æœ‰çŠ¶æ€ç ï¼Œå“åº”å¤´å’Œå“åº”æ•°æ®</td>
</tr>
<tr>
<td><code>headForHeaders</code></td>
<td>ä»¥ HEAD è¯·æ±‚èµ„æºè¿”å›æ‰€æœ‰å“åº”å¤´ä¿¡æ¯</td>
</tr>
<tr>
<td><code>postForLocation</code></td>
<td>ç”¨ POST è¯·æ±‚åˆ›å»ºèµ„æºï¼Œå¹¶è¿”å›å“åº”æ•°æ®ä¸­å“åº”å¤´çš„å­—æ®µ <code>Location</code> çš„æ•°æ®</td>
</tr>
<tr>
<td><code>postForObject</code></td>
<td>é€šè¿‡ PATCH è¯·æ±‚åˆ›å»ºèµ„æºï¼Œè·å¾—å“åº”ç»“æœ</td>
</tr>
<tr>
<td><code>put</code></td>
<td>é€šè¿‡ PUT æ–¹å¼è¯·æ±‚æ¥åˆ›å»ºæˆ–è€…æ›´æ–°èµ„æº</td>
</tr>
<tr>
<td><code>patchForObject</code></td>
<td>é€šè¿‡ PATH æ–¹å¼è¯·æ±‚æ¥æ›´æ–°èµ„æºï¼Œå¹¶è·å¾—å“åº”ç»“æœã€‚(JDK <code>HttpURLConnection</code> ä¸æ”¯æŒ PATH æ–¹å¼è¯·æ±‚ï¼Œå…¶ä»– HTTP å®¢æˆ·ç«¯åº“æ”¯æŒ)</td>
</tr>
<tr>
<td><code>delete</code></td>
<td>é€šè¿‡ DELETE æ–¹å¼åˆ é™¤èµ„æº</td>
</tr>
<tr>
<td><code>optionsForAllow</code></td>
<td>é€šè¿‡ ALLOW æ–¹å¼è¯·æ±‚æ¥è·å¾—èµ„æºæ‰€å…è®¸è®¿é—®çš„æ‰€æœ‰ HTTP æ–¹æ³•ï¼Œå¯ç”¨çœ‹æŸä¸ªè¯·æ±‚æ”¯æŒå“ªäº›è¯·æ±‚æ–¹å¼</td>
</tr>
<tr>
<td><code>exchange</code></td>
<td>æ›´é€šç”¨ç‰ˆæœ¬çš„è¯·æ±‚å¤„ç†æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ª <code>RequestEntity</code> å¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®è·¯å¾„ï¼Œè¯·æ±‚å¤´ï¼Œè¯·æ±‚ä¿¡æ¯ç­‰ï¼Œæœ€åè¿”å›ä¸€ä¸ª <code>ResponseEntity</code> å®ä½“</td>
</tr>
<tr>
<td><code>execute</code></td>
<td>æœ€é€šç”¨çš„æ‰§è¡Œ HTTP è¯·æ±‚çš„æ–¹æ³•ï¼Œä¸Šé¢æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åŸºäº <code>execute</code> çš„å°è£…ï¼Œå…¨é¢æ§åˆ¶è¯·æ±‚ä¿¡æ¯ï¼Œå¹¶é€šè¿‡å›è°ƒæ¥å£è·å¾—å“åº”æ•°æ®</td>
</tr>
</tbody>
</table>
<p>çœ‹åˆ°é‚£ä¹ˆå¤šæ–¹æ³•ä¹Ÿè®°ä¸å…¨ï¼Œä¸ºäº†æ›´å¥½ç†è§£ï¼Œå¯ä»¥ç®€å•çœ‹ä¸‹ <code>RestTemplate</code> çš„ç±»å±‚çº§ä½“ç³»ï¼Œé€šè¿‡å®˜æ–¹æºä»£ç å°±èƒ½çœ‹åˆ°:</p>
<pre><code class="language-java">/**
 * Interface specifying a basic set of RESTful operations.
 * Implemented by {@link RestTemplate}. Not often used directly, but a useful
 * option to enhance testability, as it can easily be mocked or stubbed.
 *
 * @author Arjen Poutsma
 * @author Juergen Hoeller
 * @since 3.0
 * @see RestTemplate
 */
public interface RestOperations {
    ...
}
</code></pre>
<p>å…¶å® <code>RestTemplate</code> ç±»çš„è¯·æ±‚æ–¹æ³•éƒ½æ˜¯æ¥è‡ª <code>RestOperations</code> æ¥å£çš„ï¼Œæ ¹æ®è¿™ä¸ªåå­—å°±å¯ä»¥å¤§æ¦‚çŸ¥é“è¿™ä¸ªæ¥å£ä¸»è¦å°±æ˜¯æä¾›äº† RESTful è¯·æ±‚æ“ä½œçš„æ¥å£ï¼Œå¦‚ GETï¼ŒPOSTï¼ŒPUTï¼ŒDELETE ç­‰ï¼Œå…·ä½“ä¿¡æ¯å¯ä»¥å‚è§ <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/client/RestOperations.html" title="restoperation javadoc">RestOperation javadoc</a>ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://ws3.sinaimg.cn/large/006tNc79ly1g2xg8k30ekj30gn06jq2x.jpg" alt="RestTemplate ç±»å±‚æ¬¡å›¾"></figure>
<blockquote>
<p>å…³äº RESTfulï¼š</p>
<p>æ¥è‡ªWikipedia å®šä¹‰ï¼š<strong>è¡¨ç°å±‚çŠ¶æ€è½¬æ¢</strong>ï¼Œä¸€ç§è®¾è®¡æä¾›ä¸‡ç»´ç½‘ç»œæœåŠ¡çš„<a href="https://zh.wikipedia.org/wiki/%E8%BB%9F%E4%BB%B6%E6%9E%B6%E6%A7%8B">è½¯ä»¶æ„å»ºé£æ ¼</a>ï¼Œåˆç®€ç§°ä¸º RESTã€‚</p>
<p><strong>ç”¨ URL å®šä½èµ„æºï¼Œç”¨ HTTP åŠ¨è¯æè¿°æ“ä½œï¼Œå¦‚ GET,POST,DELETE,PUT</strong>ï¼Œç®€å•æ¥è¯´é€šè¿‡ URL å°±çŸ¥é“è®¿é—®ä»€ä¹ˆèµ„æºï¼Œé€šè¿‡ HTTP Method å°±çŸ¥é“æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œé€šè¿‡ HTTP Status Code å°±çŸ¥é“æ‰§è¡Œç»“æœã€‚</p>
</blockquote>
<h2 id="å®æˆ˜-resttemplate">å®æˆ˜ <code>RestTemplate</code></h2>
<p>å¥½äº†ï¼Œç®€å•è®¤è¯†äº† <code>RestTemplate</code> ç±»ä¹‹åï¼Œæˆ‘ä»¬å…ˆç‰›åˆ€å°è¯•ï¼Œçœ‹çœ‹å¦‚ä½•ä¸Šæ‰‹ä½¿ç”¨ã€‚</p>
<h3 id="1-ç”Ÿæˆ-demo-é¡¹ç›®å¯¼å…¥-ide">1. ç”Ÿæˆ Demo é¡¹ç›®ï¼Œå¯¼å…¥ IDE</h3>
<p>ä¸ºäº†èƒ½å¿«é€Ÿæ­å»ºä¸€ä¸ª Demoï¼Œæˆ‘ä»¬è¿™è¾¹ç”¨ Spring Boot æ¡†æ¶æ­å»ºï¼Œé¦–å…ˆç”¨å®˜æ–¹æä¾›çš„ <a href="https://start.spring.io" title="Spring Initializr">Spring Initializr</a> æ¥ç”Ÿæˆå¿«é€Ÿæ„å»ºé¡¹ç›®éª¨æ¶ï¼Œé€‰æ‹© Spring Boot ç‰ˆæœ¬ 2.1.4,å…¶åº•å±‚ä¾èµ–çš„ Spring Framework ç‰ˆæœ¬ä¸ºæœ€æ–°å‘å¸ƒç‰ˆæœ¬ 5.1.6ï¼Œå¯¹äº POM ä¾èµ–åªé€‰æ‹©ä¸€ä¸ª Web æ¨¡å—å³å¯ï¼Œè¿™æ ·ä¾¿äºå¿«é€Ÿæ­å»º Web åº”ç”¨ã€‚<br>
<img src="https://ws3.sinaimg.cn/large/006tNc79ly1g2xg8z26mmj30vf0ncgn8.jpg" alt="spring initializr"></p>
<p>ç‚¹å‡»ç”Ÿæˆå·¥ç¨‹æŒ‰é’®ï¼Œå°±å¯ä»¥ä¸‹è½½åˆ°é¡¹ç›®çš„å‹ç¼©åŒ…ï¼Œè§£å‹åç”¨è‡ªå·±å¸¸ç”¨çš„ IDE å¯¼å…¥é¡¹ç›®ï¼Œé¡¹ç›®ç»“æ„æ•´ç†å¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://ws1.sinaimg.cn/large/006tNc79ly1g2xg6m6idpj30ck0d5q3e.jpg" alt="é¡¹ç›®éª¨æ¶"></figure>
<p>é¡¹ç›®ä¸­ <code>ResttemplateApplication.java</code> ä¸ºæ•´ä¸ªç¨‹åºçš„å¼•å¯¼ç±»ï¼Œç”¨äºå¯åŠ¨é¡¹ç›®ã€‚</p>
<h3 id="2-ç¼–å†™è¯·æ±‚æ§åˆ¶å™¨ç±»-productcontroller">2. ç¼–å†™è¯·æ±‚æ§åˆ¶å™¨ç±» ProductController</h3>
<p>é¦–å…ˆä¸ºäº†èƒ½å¤Ÿä½¿ç”¨ <code>RestTemplate</code> å‘é€å¤šç§æ–¹å¼ HTTP è¯·æ±‚ï¼Œå…ˆæœ¬åœ°æ„å»ºæ¥å— HTTP è¯·æ±‚çš„äº§å“æ§åˆ¶å™¨ï¼Œæ–°å»ºåŒ… <code>com.one.learn.resttemplate.controller</code>,æ–°å»ºäº§å“ Controller <code>ProductController</code> , ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@RequestMapping(&quot;/product&quot;)
@RestController
public class ProductController {

    @GetMapping(&quot;/get_product1&quot;)
    public Product get_product1() {
        return new Product(1, &quot;ProductA&quot;, BigDecimal.valueOf(6666.0));
    }

    @GetMapping(&quot;/get_product2&quot;)
    public Product get_product2(Integer id) {
        return new Product(id, &quot;ProductC&quot;, BigDecimal.valueOf(6666.0));
    }

    @GetMapping(&quot;/get_product3&quot;)
    public String get_product3(Product product) {
        return product.toString();
    }


    @PostMapping(&quot;/post_product1&quot;)
    public String post_product1(Product product) {
        return product.toString();
    }

    @PostMapping(&quot;/post_product2&quot;)
    public String post_product2(@RequestBody Product product) {
        return product.toString();
    }

    @DeleteMapping(&quot;/delete/{id}&quot;)
    public String delete(@PathVariable Integer id) {
        String result = String.format(&quot;ç¼–å·ä¸º%sçš„äº§å“åˆ é™¤æˆåŠŸ&quot;, id);
        System.out.println(result);
        return result;
    }

    @PutMapping(&quot;/update&quot;)
    public String updateByPut(Product product) {
        String result = product.toString() + &quot; æ›´æ–°æˆåŠŸ&quot;;
        System.out.println(result);
        return result;
    }

    @PostMapping(&quot;/upload&quot;)
    public String upload(MultipartRequest request) {
 	       // Spring MVC ä½¿ç”¨ MultipartRequest æ¥å—å¸¦æ–‡ä»¶çš„ HTTP è¯·æ±‚
        MultipartFile file = request.getFile(&quot;file&quot;); 
        String originalFilename = file.getOriginalFilename();
        return &quot;upload success filename: &quot; + originalFilename;
    }
}
</code></pre>
<p>åœ¨<code>Product</code> æ§åˆ¶å™¨ä¸­æ¶‰åŠçš„å®ä½“ç±» <code>Product</code> åˆ›å»ºåœ¨ <code>com.one.learn.resttemplate.bean</code> åŒ…ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public class Product {
    private Integer id;
    private String name;
    private BigDecimal price;
    
    public Product() {
    }
    
    public Product(Integer id, String name, BigDecimal price) {
        this.id = id;
        this.name = name;
        this.price = price;
    }

			    // çœå» setter getter æ–¹æ³•
	
    @Override
    public String toString() {
        return &quot;Product{&quot; +
                &quot;id='&quot; + id + '\'' +
                &quot;, name='&quot; + name + '\'' +
                &quot;, price='&quot; + price + '\'' +
                '}';
    }
}
</code></pre>
<p>æœ‰äº†è¿™äº›ç±»ï¼Œå°±å¯ä»¥åˆ©ç”¨ç¨‹åºå¼•å¯¼ç±» <code>ResttemplateApplication</code> å¯åŠ¨ Spring Boot é¡¹ç›®ï¼Œä¸€ä¸ªç®€å•çš„ Web åº”ç”¨å°±è¯ç”Ÿäº†,ç›‘å¬ 8080 ç«¯å£ï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>
<img src="https://ws1.sinaimg.cn/large/006tNc79ly1g2xg9hbqctj31830ei0x3.jpg" alt="é¡¹ç›®å¯åŠ¨"></p>
<p>æˆ‘ä»¬å¯ä»¥ç®€å•æµ‹è¯•ä¸€ä¸‹ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® <code>http://localhost:8080/product/get_product1</code>ï¼Œä¼šçœ‹åˆ°å¦‚å›¾æ‰€ç¤ºçš„ç»“æœï¼š</p>
<figure data-type="image" tabindex="3"><img src="https://ws4.sinaimg.cn/large/006tNc79ly1g2xg9l5hpuj30cr06kwek.jpg" alt="é¡¹ç›®è®¿é—®"></figure>
<h3 id="3-ç¼–å†™æµ‹è¯•ç±»ç”¨-resttemplate-å‘é€-http-è¯·æ±‚">3. ç¼–å†™æµ‹è¯•ç±»ç”¨ RestTemplate å‘é€ HTTP è¯·æ±‚</h3>
<p>æœ‰äº† Web æœåŠ¡ï¼Œæ¥ä¸‹æ¥è¯¥ä½¿ç”¨ <code>RestTemplate</code> æ¥å‘é€è¯·æ±‚å¹¶å¤„ç†å“åº”äº†ã€‚æˆ‘ä»¬åœ¨ <code>test</code> æ–‡ä»¶ä¸‹æ–°å»ºä¸€ä¸ªæµ‹è¯•ç±» <code>com.one.learn.resttemplate.RestTemplateTests</code>,ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public class RestTemplateTests {
    RestTemplate restTemplate = null;

    @Before
    public void setup() {
        restTemplate = new RestTemplate();
    }
    
}
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡ç¼–å†™æµ‹è¯•æ–¹æ³•æ¥ç”¨ <code>RestTemplate</code> API å®ç°å¯¹ <code>Product</code> æ§åˆ¶å™¨å„ä¸ªæ¥å£çš„è¯·æ±‚ã€‚</p>
<h4 id="get-è¯·æ±‚">GET è¯·æ±‚</h4>
<p>æˆ‘ä»¬å…ˆæœ€ç®€å•çš„ä¸‹æ‰‹ï¼Œå°è¯•ç”¨ <code>RestTemplate</code> è®¿é—®è¯·æ±‚è·¯å¾„ä¸º <code>product/get_product1</code>, ä¸€ä¸ªä¸å¸¦ä»»ä½•å‚æ•° çš„ GET è¯·æ±‚ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@Test
public void testGet_product1() {
   String url = &quot;http://localhost:8080/product/get_product1&quot;;
   //æ–¹å¼ä¸€ï¼šGET æ–¹å¼è·å– JSON ä¸²æ•°æ®
   String result = restTemplate.getForObject(url, String.class);
   System.out.println(&quot;get_product1è¿”å›ç»“æœï¼š&quot; + result);
   Assert.hasText(result, &quot;get_product1è¿”å›ç»“æœä¸ºç©º&quot;);
	
	   //æ–¹å¼äºŒï¼šGET æ–¹å¼è·å– JSON æ•°æ®æ˜ å°„åçš„ Product å®ä½“å¯¹è±¡
   Product product = restTemplate.getForObject(url, Product.class);
   System.out.println(&quot;get_product1è¿”å›ç»“æœï¼š&quot; + product);
   Assert.notNull(product, &quot;get_product1è¿”å›ç»“æœä¸ºç©º&quot;);
	
	   //æ–¹å¼ä¸‰ï¼šGET æ–¹å¼è·å–åŒ…å« Product å®ä½“å¯¹è±¡ çš„å“åº”å®ä½“ ResponseEntity å¯¹è±¡,ç”¨ getBody() è·å–
   ResponseEntity&lt;Product&gt; responseEntity = restTemplate.getForEntity(url, Product.class);
   System.out.println(&quot;get_product1è¿”å›ç»“æœï¼š&quot; + responseEntity);
   Assert.isTrue(responseEntity.getStatusCode().equals(HttpStatus.OK), &quot;get_product1å“åº”ä¸æˆåŠŸ&quot;);
   
}
</code></pre>
<p>é¦–å…ˆçœ‹ä¸‹è¿è¡Œæµ‹è¯•æ–¹æ³• <code>testGet_product1</code> åæ§åˆ¶å°çš„è¾“å‡ºæ—¥å¿—ï¼š</p>
<pre><code>...
get_product1è¿”å›ç»“æœï¼š{&quot;id&quot;:1,&quot;name&quot;:&quot;ProductA&quot;,&quot;price&quot;:6666.0}
...
get_product1è¿”å›ç»“æœï¼šProduct{id='1', name='ProductA', price='6666.0'}
...
get_product1è¿”å›ç»“æœï¼š&lt;200,Product{id='1', name='ProductA', price='6666.0'},[Content-Type:&quot;application/json;charset=UTF-8&quot;, Transfer-Encoding:&quot;chunked&quot;, Date:&quot;Thu, 09 May 2019 15:37:25 GMT&quot;]&gt;
...
</code></pre>
<p>å¯ä»¥çœ‹åˆ° <code>testGet_product1</code> è¯·æ±‚éƒ½æ˜¯æˆåŠŸå“åº”å¹¶è·å–åˆ°äº†æ•°æ®ï¼Œä»ä¸Šé¢ä»£ç ä¸Šçœ‹æ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚ç°åœ¨æ¥ç‚¹ç•¥å¤æ‚çš„è¯·æ±‚æ–¹å¼ï¼Œä½¿ç”¨  <code>RestTemplate</code> API ä¸­ <code>exchange</code> å’Œ <code>execute</code> æ–¹æ³•å‘é€ GET è¯·æ±‚ï¼Œå¯ä»¥æ›´åŠ ç»†ç²’åº¦æ§åˆ¶è¯·æ±‚çš„è¡Œä¸ºï¼Œå¦‚ <code>Header</code> ä¿¡æ¯ï¼Œæ•°æ®å¤„ç†æ–¹å¼ç­‰,åŒæ ·åœ¨ <code>testGet_product1</code> æ–¹æ³•é‡Œæ·»åŠ ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@Test
public void testGet_product1() {
    String url = &quot;http://localhost:8080/product/get_product1&quot;;
    //....
    
    //æ–¹å¼ä¸€ï¼š æ„å»ºè¯·æ±‚å®ä½“ HttpEntity å¯¹è±¡ï¼Œç”¨äºé…ç½® Header ä¿¡æ¯å’Œè¯·æ±‚å‚æ•°
    MultiValueMap header = new LinkedMultiValueMap();
    header.add(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE);
    HttpEntity&lt;Object&gt; requestEntity = new HttpEntity&lt;&gt;(header);
    //æ–¹å¼äºŒï¼š æ‰§è¡Œè¯·æ±‚è·å–åŒ…å« Product å®ä½“å¯¹è±¡ çš„å“åº”å®ä½“ ResponseEntity å¯¹è±¡,ç”¨ getBody() è·å–
    ResponseEntity&lt;Product&gt; exchangeResult = restTemplate.exchange(url, HttpMethod.GET, requestEntity, Product.class);
    System.out.println(&quot;get_product1è¿”å›ç»“æœï¼š&quot; + exchangeResult);
    Assert.isTrue(exchangeResult.getStatusCode().equals(HttpStatus.OK), &quot;get_product1å“åº”ä¸æˆåŠŸ&quot;);

    	//æ–¹å¼ä¸‰ï¼š æ ¹æ® RequestCallback æ¥å£å®ç°ç±»è®¾ç½®Headerä¿¡æ¯,ç”¨ ResponseExtractor æ¥å£å®ç°ç±»è¯»å–å“åº”æ•°æ®
    String executeResult = restTemplate.execute(url, HttpMethod.GET, request -&gt; {
        request.getHeaders().add(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE);
    }, (clientHttpResponse) -&gt; {
        InputStream body = clientHttpResponse.getBody();
        byte[] bytes = new byte[body.available()];
        body.read(bytes);
        return new String(bytes);
    }); // å¤‡æ³¨ï¼šè¿™é‡Œä½¿ç”¨äº† Java8 ç‰¹æ€§ï¼šLambda è¡¨è¾¾å¼è¯­æ³•ï¼Œè‹¥æœªæ¥è§¦ Lambda è¡¨è¾¾å¼åå¯ä»¥ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»ä»£æ›¿å®ç°
    System.out.println(&quot;get_product1è¿”å›ç»“æœï¼š&quot; + executeResult);
    Assert.hasText(executeResult, &quot;get_product1è¿”å›ç»“æœä¸ºç©º&quot;);
}
</code></pre>
<p>åŒæ ·å†è¿è¡Œæµ‹è¯•æ–¹æ³• <code>testGet_product1</code> åæ§åˆ¶å°çš„è¾“å‡ºæ—¥å¿—ï¼š</p>
<pre><code>...
get_product1è¿”å›ç»“æœï¼š&lt;200,Product{id='1', name='ProductA', price='6666.0'},[Content-Type:&quot;application/json;charset=UTF-8&quot;, Transfer-Encoding:&quot;chunked&quot;, Date:&quot;Thu, 09 May 2019 16:00:22 GMT&quot;]&gt;
...
get_product1è¿”å›ç»“æœï¼š{&quot;id&quot;:1,&quot;name&quot;:&quot;ProductA&quot;,&quot;price&quot;:6666.0}
...
</code></pre>
<p>ç»“æœä¹Ÿéƒ½æ˜¯æ­£å¸¸è¿”å›ï¼Œè¯´æ˜æ‰§è¡Œçš„è¯·æ±‚éƒ½æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>ç°åœ¨æ¥å°è¯•æ‰§è¡Œå¸¦æœ‰å‚æ•°çš„ GET è¯·æ±‚ï¼ŒåŒæ ·çš„æ–¹å¼ç¼–å†™ä¸€ä¸ªæ–°çš„æµ‹è¯•æ–¹æ³•ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@Test
public void testGet_product2() {
    String url = &quot;http://localhost:8080/product/get_product2/id={id}&quot;;
	
	    //æ–¹å¼ä¸€ï¼šå°†å‚æ•°çš„å€¼å­˜åœ¨å¯å˜é•¿åº¦å‚æ•°é‡Œï¼ŒæŒ‰ç…§é¡ºåºè¿›è¡Œå‚æ•°åŒ¹é…
    ResponseEntity&lt;Product&gt; responseEntity = restTemplate.getForEntity(url, Product.class, 101);
    System.out.println(responseEntity);
    Assert.isTrue(responseEntity.getStatusCode().equals(HttpStatus.OK), &quot;get_product2 è¯·æ±‚ä¸æˆåŠŸ&quot;);
    Assert.notNull(responseEntity.getBody().getId(), &quot;get_product2  ä¼ é€’å‚æ•°ä¸æˆåŠŸ&quot;);

	    //æ–¹å¼äºŒï¼šå°†è¯·æ±‚å‚æ•°ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨åˆ° Map é›†åˆä¸­ï¼Œç”¨äºè¯·æ±‚æ—¶URLä¸Šçš„æ‹¼æ¥
    Map&lt;String, Object&gt; uriVariables = new HashMap&lt;&gt;();
    uriVariables.put(&quot;id&quot;, 101);
    Product result = restTemplate.getForObject(url, Product.class, uriVariables);
    System.out.println(result);
    Assert.notNull(result.getId(), &quot;get_product2  ä¼ é€’å‚æ•°ä¸æˆåŠŸ&quot;);
}
</code></pre>
<p>æ­£å¸¸è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>...
&lt;200,Product{id='101', name='ProductC', price='6666.0'},[Content-Type:&quot;application/json;charset=UTF-8&quot;, Transfer-Encoding:&quot;chunked&quot;, Date:&quot;Fri, 10 May 2019 14:53:41 GMT&quot;]&gt;
...
Product{id='101', name='ProductC', price='6666.0'}
...
</code></pre>
<h4 id="post-è¯·æ±‚">POST è¯·æ±‚</h4>
<p>äº†è§£å®Œå¦‚ä½•ç”¨ <code>RestTemplate</code> API å‘é€ GET è¯·æ±‚åï¼Œå†çœ‹ä¸‹å¹³æ—¶ä¹Ÿå¾ˆå¸¸è§çš„ POST è¯·æ±‚å¦‚ä½•ä½¿ç”¨ã€‚ç”±äº POST è¯·æ±‚æ•°æ®çš„å†…å®¹ç±»å‹ <code>Content-Type</code> ä¸åŒï¼Œå‘é€ POST è¯·æ±‚æƒ…å†µç›¸å¯¹å°±å¤šäº†ï¼Œæˆ‘ä»¬è¿™é‡Œä»¥å¸¸ç”¨çš„ <code>application/x-www-form-urlencoded</code> å’Œ <code>application/json</code> è¿™ä¸¤ç§å†…å®¹ç±»å‹ä¸ºä¾‹å­ã€‚</p>
<ul>
<li>
<p>å‘é€ <code>Content-Type</code> ä¸º <code>application/x-www-form-urlencoded</code> çš„ POST è¯·æ±‚ï¼š</p>
<pre><code class="language-java">@Test
</code></pre>
</li>
</ul>
<p>public void testPost_product1() {<br>
String url = &quot;http://localhost:8080/product/post_product1&quot;;<br>
Product product = new Product(201, &quot;Macbook&quot;, BigDecimal.valueOf(10000));<br>
// è®¾ç½®è¯·æ±‚çš„ Content-Type ä¸º application/x-www-form-urlencoded<br>
MultiValueMap&lt;String, String&gt; header = new LinkedMultiValueMap();<br>
header.add(HttpHeaders.CONTENT_TYPE, (MediaType.APPLICATION_FORM_URLENCODED_VALUE));</p>
<pre><code>	 //æ–¹å¼äºŒï¼š å°†è¯·æ±‚å‚æ•°å€¼ä»¥ K=V æ–¹å¼ç”¨ &amp; æ‹¼æ¥ï¼Œå‘é€è¯·æ±‚ä½¿ç”¨
    String productStr = &quot;id=&quot; + product.getId() + &quot;&amp;name=&quot; + product.getName() + &quot;&amp;price=&quot; + product.getPrice();
    HttpEntity&lt;String&gt; request = new HttpEntity&lt;&gt;(productStr, header);
    ResponseEntity&lt;String&gt; exchangeResult = restTemplate.exchange(url, HttpMethod.POST, request, String.class);
    System.out.println(&quot;post_product1: &quot; + exchangeResult);
    Assert.isTrue(exchangeResult.getStatusCode().equals(HttpStatus.OK), &quot;post_product1 è¯·æ±‚ä¸æˆåŠŸ&quot;);

	    //æ–¹å¼ä¸€ï¼š å°†è¯·æ±‚å‚æ•°ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨åœ¨ MultiValueMap é›†åˆï¼Œå‘é€è¯·æ±‚æ—¶ä½¿ç”¨
    MultiValueMap&lt;String, Object&gt; map = new LinkedMultiValueMap();
    map.add(&quot;id&quot;, (product.getId()));
    map.add(&quot;name&quot;, (product.getName()));
    map.add(&quot;price&quot;, (product.getPrice()));
    HttpEntity&lt;MultiValueMap&gt; request2 = new HttpEntity&lt;&gt;(map, header);
    ResponseEntity&lt;String&gt; exchangeResult2 = restTemplate.exchange(url, HttpMethod.POST, request2, String.class);
    System.out.println(&quot;post_product1ï¼š &quot; + exchangeResult2);
    Assert.isTrue(exchangeResult.getStatusCode().equals(HttpStatus.OK), &quot;post_product1 è¯·æ±‚ä¸æˆåŠŸ&quot;);
</code></pre>
<p>}<br>
```<br>
å¯¹åº”çš„è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<pre><code>```
</code></pre>
<p>...<br>
post_product1: &lt;200,Product{id='201', name='Macbook', price='10000'},[Content-Type:&quot;text/plain;charset=UTF-8&quot;, Content-Length:&quot;48&quot;, Date:&quot;Fri, 10 May 2019 16:07:43 GMT&quot;]&gt;<br>
...<br>
post_product1ï¼š &lt;200,Product{id='201', name='Macbook', price='10000'},[Content-Type:&quot;text/plain;charset=UTF-8&quot;, Content-Length:&quot;48&quot;, Date:&quot;Fri, 10 May 2019 16:07:43 GMT&quot;]&gt;<br>
```</p>
<ul>
<li>
<p>å‘é€ <code>Content-Type</code> ä¸º <code>application/json</code> çš„ POST è¯·æ±‚ï¼š</p>
<pre><code class="language-java">@Test
</code></pre>
</li>
</ul>
<p>public void testPost_product2() {<br>
String url = &quot;http://localhost:8080/product/post_product2&quot;;</p>
<pre><code>// è®¾ç½®è¯·æ±‚çš„ Content-Type ä¸º application/json
MultiValueMap&lt;String, String&gt; header = new LinkedMultiValueMap();
header.put(HttpHeaders.CONTENT_TYPE, Arrays.asList(MediaType.APPLICATION_JSON_VALUE));
// è®¾ç½® Accept å‘æœåŠ¡å™¨è¡¨æ˜å®¢æˆ·ç«¯å¯å¤„ç†çš„å†…å®¹ç±»å‹
header.put(HttpHeaders.ACCEPT, Arrays.asList(MediaType.APPLICATION_JSON_VALUE));
// ç›´æ¥å°†å®ä½“ Product ä½œä¸ºè¯·æ±‚å‚æ•°ä¼ å…¥ï¼Œåº•å±‚åˆ©ç”¨ Jackson æ¡†æ¶åºåˆ—åŒ–æˆ JSON ä¸²å‘é€è¯·æ±‚
HttpEntity&lt;Product&gt; request = new HttpEntity&lt;&gt;(new Product(2, &quot;Macbook&quot;, BigDecimal.valueOf(10000)), header);
ResponseEntity&lt;String&gt; exchangeResult = restTemplate.exchange(url, HttpMethod.POST, request, String.class);
System.out.println(&quot;post_product2: &quot; + exchangeResult);
Assert.isTrue(exchangeResult.getStatusCode().equals(HttpStatus.OK), &quot;post_product2 è¯·æ±‚ä¸æˆåŠŸ&quot;);
</code></pre>
<p>}<br>
```</p>
<pre><code>éªŒè¯çš„è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š

```
Â·Â·Â·
post_product2: &lt;200,Product{id='2', name='Macbook', price='10000'},[Content-Type:&quot;application/json;charset=UTF-8&quot;, Content-Length:&quot;46&quot;, Date:&quot;Fri, 10 May 2019 16:09:11 GMT&quot;]&gt;
Â·Â·Â·
```
</code></pre>
<h4 id="delete-è¯·æ±‚-å’Œ-put-è¯·æ±‚">DELETE è¯·æ±‚ å’Œ PUT è¯·æ±‚</h4>
<p>DELETE è¯·æ±‚å’Œ PUT è¯·æ±‚å±äº RESTful è¯·æ±‚æ–¹å¼çš„ä¸¤ç§ï¼Œä½†é€šå¸¸ä¸ä¼šè¢«ä½¿ç”¨åˆ°ï¼Œè¿™é‡Œä¹Ÿåªæ˜¯ç®€å•æ¼”ç¤ºä¸‹ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">// DELETE æ–¹æ³•è¯·æ±‚
@Test
public void testDelete() {
   String url = &quot;http://localhost:8080/product/delete/{id}&quot;;
   restTemplate.delete(url, 101);
}

// PUT æ–¹æ³•è¯·æ±‚
@Test
public void testPut() {
    String url = &quot;http://localhost:8080/product/update&quot;;
    Map&lt;String, ?&gt; variables = new HashMap&lt;&gt;();
    MultiValueMap&lt;String, String&gt; header = new LinkedMultiValueMap();
    header.put(HttpHeaders.CONTENT_TYPE, Arrays.asList(MediaType.APPLICATION_FORM_URLENCODED_VALUE));
    Product product = new Product(101, &quot;iWatch&quot;, BigDecimal.valueOf(2333));
    String productStr = &quot;id=&quot; + product.getId() + &quot;&amp;name=&quot; + product.getName() + &quot;&amp;price=&quot; + product.getPrice();
    HttpEntity&lt;String&gt; request = new HttpEntity&lt;&gt;(productStr, header);
    restTemplate.put(url, request);
}
</code></pre>
<h3 id="ä¸Šä¼ æ–‡ä»¶">ä¸Šä¼ æ–‡ä»¶</h3>
<p>ç°åœ¨æˆ‘ä»¬å†è¯•ä¸‹å¦‚ä½•ä½¿ç”¨ <code>RestTemplate</code> API è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ,ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆçœ‹ä¸‹å®ç°ä»£ç :</p>
<pre><code class="language-java">@Test
public void testUploadFile() {
    String url = &quot;http://localhost:8080/product/upload&quot;;
    MultiValueMap&lt;String, Object&gt; body = new LinkedMultiValueMap&lt;&gt;();
    FileSystemResource file = new FileSystemResource(new File(&quot;/Users/One/Desktop/b.txt&quot;));
    body.add(&quot;file&quot;, file);

    MultiValueMap&lt;String, String&gt; header = new LinkedMultiValueMap();
    header.put(HttpHeaders.CONTENT_TYPE, Arrays.asList(MediaType.MULTIPART_FORM_DATA_VALUE));
    HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; requestEntity = new HttpEntity&lt;&gt;(body, header);
    ResponseEntity&lt;String&gt; responseEntity = restTemplate.postForEntity(url, requestEntity, String.class);
    System.out.println(&quot;upload: &quot; + responseEntity);
    Assert.isTrue(responseEntity.getStatusCode().equals(HttpStatus.OK), &quot;upload è¯·æ±‚ä¸æˆåŠŸ&quot;);
}
</code></pre>
<p>å¦‚æœéœ€è¦ä¸Šä¼ æ–‡ä»¶ç±»å‹æ•°æ®ï¼Œå°±åªèƒ½ä½¿ç”¨ POST è¯·æ±‚ï¼Œå¹¶ä¸”å†…å®¹ç±»å‹ä¸º <code>multipart/form-data</code>,éœ€è¦æ‰‹åŠ¨ç»™ <code>Header</code> æŒ‡å®šè¿™ä¸ª <code>Content-Type</code>ã€‚è€Œéœ€è¦ä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥ç”¨ <code>FileSystemResource</code> å¯¹è±¡å°è£…ï¼Œè¡¨ç¤ºäº†ä¸€ä¸ªæ–‡ä»¶èµ„æºï¼ŒåŒæ—¶æœåŠ¡ç«¯éœ€è¦ç”¨ <code>MultipartRequest</code> å¯¹è±¡æ¥è·å–æ–‡ä»¶æ•°æ®ã€‚ç»“åˆå·²è¿è¡Œçš„ Web æœåŠ¡ï¼Œè¿è¡Œä¸Šè¿°æµ‹è¯•æ–¹æ³•å³å¯å¾—åˆ°ä¸‹é¢æ—¥å¿—è¾“å‡º:</p>
<pre><code>...
upload: &lt;200,upload success filename: b.txt,[Content-Type:&quot;text/plain;charset=UTF-8&quot;, Content-Length:&quot;30&quot;, Date:&quot;Fri, 10 May 2019 17:00:45 GMT&quot;]&gt;
...
</code></pre>
<h2 id="è¿›é˜¶-resttemplate">è¿›é˜¶ RestTemplate</h2>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å­¦ä¹ äº† <code>RestTemplate</code> API è¯·æ±‚æ•°æ®çš„å‡ ç§å¸¸è§æ–¹å¼ï¼Œç°åœ¨æ¥è¿›ä¸€æ­¥åœ°æ·±å…¥ä½¿ç”¨ <code>RestTemplate</code>ã€‚</p>
<h3 id="åº•å±‚-http-è¯·æ±‚åº“åˆ‡æ¢">åº•å±‚ HTTP è¯·æ±‚åº“åˆ‡æ¢</h3>
<p>æˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼š</p>
<blockquote>
<p>The default constructor uses java.net.HttpURLConnection to perform requests. You can switch to a different HTTP library with an implementation of ClientHttpRequestFactory. There is built-in support for the following:</p>
<ul>
<li>Apache HttpComponents</li>
<li>Netty</li>
<li>OkHttp</li>
</ul>
</blockquote>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡º <code>RestTemplate</code> é»˜è®¤ä½¿ç”¨ JDK åŸç”Ÿçš„ <code>java.net.HttpURLConnection</code> æ‰§è¡Œè¯·æ±‚ã€‚è€Œé™¤æ­¤ä¹‹å¤–ï¼ŒSpring è¿˜å°è£…äº† Apache HttpComponentsï¼Œ Nettyï¼Œ OkHttp ä¸‰ç§è¯·æ±‚åº“ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬å¹³å¸¸ç”¨çš„ <code>HttpClient</code> API ç›¸å…³çš„åº“ï¼Œè€Œ <a href="https://netty.io/" title="Netty">Netty</a> åˆ™æ˜¯ä¸€ä¸ªæ€§èƒ½é«˜çš„NIO è¯·æ±‚å¤„ç†ç½‘ç»œåº“ï¼Œ<a href="https://square.github.io/okhttp" title="OkHttp">OkHttp</a> ä¸ºåŠŸèƒ½ä¸°å¯Œä¸”é«˜æ•ˆçš„ç½‘ç»œæ¡†æ¶ï¼Œå¤šç”¨äº Android ç¨‹åºã€‚</p>
<p>è€Œæˆ‘ä»¬ä¸Šæ–‡é‡‡ç”¨é»˜è®¤çš„æ„é€ å™¨æ–¹æ³•åˆ›å»ºçš„ <code>RestTemplate</code> å®ä¾‹ï¼Œå³é‡‡ç”¨äº† JDK åŸç”Ÿçš„ç½‘ç»œ APIã€‚æƒ³è¦åˆ‡æ¢ï¼Œåªéœ€è¦åœ¨æ„é€ æ–¹æ³•ä¸­ä¼ å…¥ç‰¹å®š <code>ClientHttpRequestFactory</code> å®ç°ç±»å³å¯,å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">RestTemplate template = new RestTemplate(new HttpComponentsClientHttpRequestFactory());
</code></pre>
<p>æˆ‘ä»¬æŸ¥çœ‹ <code>RestTemplate</code> æºç æ‰¾ä¸åˆ°é»˜è®¤é‡‡ç”¨JDK <code>HttpURLConnection</code> API çš„ä»£ç ï¼Œé‚£å°±æ ¹æ®å‰æ–‡ç»™å‡º <code>RestTemplate</code> ç±»å±‚æ¬¡å›¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œå¯ä»¥åœ¨çˆ¶ç±» <code>HttpAccessor</code> ä¸Šèƒ½æ‰¾åˆ°å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">public abstract class HttpAccessor {
	// ...
	private ClientHttpRequestFactory requestFactory = new SimpleClientHttpRequestFactory();
	// ...
}
</code></pre>
<p>è€Œ Spring å¯¹å·¥å‚ç±» <code>SimpleClientHttpRequestFactory</code> æè¿°ä¸º: <code>implementation that uses standard JDK facilities</code>ï¼Œ ä¹Ÿæ­£è¯´æ˜äº†é»˜è®¤æ„é€  <code>RestTemplate</code> å®ä¾‹çš„è¡Œä¸ºéƒ½ä¼šç›´æ¥ä½¿ç”¨ JDK ç½‘ç»œ APIã€‚</p>
<h3 id="è¯·æ±‚è¶…æ—¶è®¾ç½®">è¯·æ±‚è¶…æ—¶è®¾ç½®</h3>
<p>é€šå¸¸æˆ‘ä»¬ä¼šå¯¹ HTTP è¯·æ±‚ç±»è¿›è¡Œæ‰§è¡Œè¡Œä¸ºçš„å®šåˆ¶ï¼Œä¾‹å¦‚è°ƒç”¨è¶…æ—¶æ—¶é—´è®¾ç½®ï¼Œè¿æ¥æ—¶é•¿çš„é™åˆ¶ç­‰ï¼Œè€Œé‡‡ç”¨é»˜è®¤çš„ <code>HttpURLConnection</code> é»˜è®¤çš„é…ç½®æ—¶ï¼Œ ä» <code>SimpleClientHttpRequestFactory</code> æºç ç±»å¯ä»¥çœ‹åˆ°æ˜¯æ²¡æœ‰è¶…æ—¶é™åˆ¶ï¼Œä¹Ÿå°±æ„å‘³ç€æ— é™ç­‰å¾…è¯·æ±‚å“åº”ï¼š</p>
<pre><code class="language-java">// RestTemplate é»˜è®¤è¶…æ—¶è®¾ç½®
...
private int connectTimeout = -1;
private int readTimeout = -1;
...
</code></pre>
<p>é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•è°ƒæ•´è¶…æ—¶æ—¶é—´,å¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>RestTemplate customRestTemplate = new RestTemplate(getClientHttpRequestFactory());

private SimpleClientHttpRequestFactory getClientHttpRequestFactory() {
    SimpleClientHttpRequestFactory clientHttpRequestFactory
            = new SimpleClientHttpRequestFactory();
    // è¿æ¥è¶…æ—¶è®¾ç½® 10s
    clientHttpRequestFactory.setConnectTimeout(10_000);

    // è¯»å–è¶…æ—¶è®¾ç½® 10s
    clientHttpRequestFactory.setReadTimeout(10_000);
    return clientHttpRequestFactory;
}
</code></pre>
<p>å¦‚æœè¦è°ƒæ•´  <code>HttpComponentsClient</code> çš„è¶…æ—¶è®¾ç½®ï¼Œå¯ä»¥å‚è€ƒæ–‡ç« <a href="https://howtodoinjava.com/spring-boot2/resttemplate-timeout-example/" title="resttemplate-timeout-example">resttemplate-timeout-example</a> ã€‚å½“ç„¶é™¤äº†è®¾ç½®è¶…æ—¶æ—¶é—´ä¹‹å¤–ï¼Œè¿˜æœ‰æ›´å¤šå‚æ•°è¿›è¡Œå®šåˆ¶ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œå¯ä»¥å‚è€ƒæ–‡ç«  <a href="https://howtodoinjava.com/spring-restful/resttemplate-httpclient-java-config/" title="resttemplate-httpclient-java-config">resttemplate-httpclient-java-config</a> è¿›ä¸€æ­¥å­¦ä¹ ã€‚</p>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬å¯¹ <code>RestTemplate</code> çš„å­¦ä¹ å‘Šä¸€æ®µè½ï¼Œå¦‚æœæœ‰å…´è¶£å¯ä»¥è¿›ä¸€æ­¥ç ”ç©¶ä¸‹ç›¸å…³æºç ï¼Œæœ‰æœºä¼šå°è¯•ä½¿èµ·æ¥å§ã€‚ğŸ˜</p>
<figure data-type="image" tabindex="4"><img src="https://ws2.sinaimg.cn/large/006tNc79ly1g2xgsoqkphj30760763yr.jpg" alt="äºŒç»´ç "></figure>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<p>https://www.baeldung.com/rest-template</p>
<p>http://blog.didispace.com/spring-boot-learning-21-1-1</p>
<p>https://www.baeldung.com/spring-rest-template-multipart-upload</p>
<p>https://www.zhihu.com/question/28557115</p>
<p>https://howtodoinjava.com/spring-boot2/resttemplate-timeout-example</p>
<p>https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/integration.html#rest-client-access</p>
<p>https://zh.wikipedia.org/wiki/%E8%A1%A8%E7%8E%B0%E5%B1%82%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2</p>
<p>https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/client/RestOperations.html</p>

        </div>

        
          <a class="animated fadeInUp p-2 items-center text-sm text-gray-700 border hover:bg-gray-300 leading-none rounded-full flex lg:inline-flex m-4 " href="https://wrcj12138aaa.github.io//tag/VSWLYuWEZR">
            <span class="flex-auto">Spring</span>
          </a>
        


        <div class="flex justify-between py-8">
          
            <div class="prev-post">
              <a href="https://wrcj12138aaa.github.io//post/20190518-ä¸€èµ·å­¦ Spring ä¹‹å¼‚å¸¸å¤„ç†">
                <h3 class="post-title">
                  <i class="remixicon-arrow-left-line"></i>
                  ä¸€èµ·å­¦ Spring ä¹‹ å¼‚å¸¸å¤„ç†
                </h3>
              </a>
            </div>
          

          
            <div class="next-post">
              <a href="https://wrcj12138aaa.github.io//post/20190504-è¯‘ - Spring æ ¸å¿ƒæŠ€æœ¯ä¹‹ Spring å®¹å™¨æ‰©å±•ç‚¹">
                <h3 class="post-title">
                  è¯‘- Spring æ ¸å¿ƒæŠ€æœ¯ä¹‹ Spring å®¹å™¨æ‰©å±•ç‚¹
                  <i class="remixicon-arrow-right-line"></i>
                </h3>
              </a>
            </div>
          
        </div>

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '2ba76d6fe50ad2b384eb',
    clientSecret: '90db763ed48942571725d6aef11229900c8bb656',
    repo: 'wrcj12138aaa.github.io',
    owner: 'wrcj12138aaa',
    admin: ['wrcj12138aaa'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

      </div>
    </div>

    <script src="https://wrcj12138aaa.github.io//media/prism.js"></script>  
<script>

Prism.highlightAll()

let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

// This should probably be throttled.
// Especially because it triggers during smooth scrolling.
// https://lodash.com/docs/4.17.10#throttle
// You could do like...
// window.addEventListener("scroll", () => {
//    _.throttle(doThatStuff, 100);
// });
// Only not doing it here to keep this Pen dependency-free.

window.addEventListener("scroll", event => {
  let fromTop = window.scrollY;

  mainNavLinks.forEach((link, index) => {
    let section = document.getElementById(decodeURI(link.hash).substring(1));
    let nextSection = null
    if (mainNavLinks[index + 1]) {
      nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
    }
    if (section.offsetTop <= fromTop) {
      if (nextSection) {
        if (nextSection.offsetTop > fromTop) {
          link.classList.add("current");
        } else {
          link.classList.remove("current");    
        }
      } else {
        link.classList.add("current");
      }
    } else {
      link.classList.remove("current");
    }
  });
});


document.addEventListener("DOMContentLoaded", function() {
  var lazyImages = [].slice.call(document.querySelectorAll(".post-feature-image.lazy"));

  if ("IntersectionObserver" in window) {
    let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          let lazyImage = entry.target
          lazyImage.style.backgroundImage = `url(${lazyImage.dataset.bg})`
          lazyImage.classList.remove("lazy")
          lazyImageObserver.unobserve(lazyImage)
        }
      });
    });

    lazyImages.forEach(function(lazyImage) {
      lazyImageObserver.observe(lazyImage)
    })
  } else {
    // Possibly fall back to a more compatible method here
  }
});

const menuContainer = document.querySelector('.menu-container')
const menus = document.querySelectorAll('.menu-container .menu')
const mask = document.querySelector('.mask')
const contentWrapper = document.querySelector('.content-wrapper')
const latestArticle = document.querySelector('.latest-article')
const readMore = document.querySelector('.read-more')
const indexPage = document.querySelector('.index-page')

const isHome = location.pathname === '/'
if (latestArticle) {
  latestArticle.style.display = isHome ? 'block' : 'none'
  readMore.style.display = isHome ? 'block' : 'none'
  indexPage.style.display = isHome ? 'none' : 'block'
}

const openMenu = () => {
  menuContainer.classList.add('open')
  menus.forEach(menu => {
    menu.classList.add('animated', 'fadeInLeft')
  })
  mask.classList.add('open')
  contentWrapper.classList.add('is-second')
}

const closeMenu = () => {
  menuContainer.classList.remove('open')
  menus.forEach(menu => {
    menu.classList.remove('animated', 'fadeInLeft')
  })
  mask.classList.remove('open')
  contentWrapper.classList.remove('is-second')
}
</script>
  
  </body>
</html>
