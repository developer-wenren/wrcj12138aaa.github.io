<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é—»äººçš„æŠ€æœ¯åšå®¢</title>
<meta name="description" content="åšä¸€ä¸ªç»ˆç”Ÿå­¦ä¹ è€…" />
<link rel="shortcut icon" href="https://wrcj12138aaa.github.io//favicon.ico?v=1570432632262">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link href="https://cdn.remixicon.com/releases/v1.3.1/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">

<link rel="stylesheet" href="https://wrcj12138aaa.github.io//styles/main.css">
<link rel="alternate" type="application/atom+xml" title="é—»äººçš„æŠ€æœ¯åšå®¢ - Atom Feed" href="https://wrcj12138aaa.github.io//atom.xml">



  </head>
  <body>
    <div id="app" class="main px-4 flex flex-col lg:flex-row">
      <div id="sidebar" class="sidebar-wrapper lg:static lg:w-1/4">
  <div class="lg:sticky top-0">
    <div class="sidebar-content">
      <div class="flex lg:block p-4 lg:px-0 items-center fixed lg:static lg:block top-0 right-0 left-0 bg-white z-50">
        <i class="remixicon-menu-2-line lg:mt-4 text-2xl cursor-pointer animated fadeIn" onclick="openMenu()"></i>
        <a href="https://wrcj12138aaa.github.io/">
          <img class="animated fadeInLeft avatar rounded-lg mx-4 lg:mt-32 lg:mx-0 mt-0 lg:w-24 lg:h-24 w-12 w-12" src="https://wrcj12138aaa.github.io//images/avatar.png?v=1570432632262" alt="">
        </a>
        <h1 class="animated fadeInLeft lg:text-4xl font-extrabold lg:mt-8 mt-0 text-xl" style="animation-delay: 0.2s">é—»äººçš„æŠ€æœ¯åšå®¢</h1>
      </div>
      
        <div class="animated fadeInLeft" style="animation-delay: 0.4s">
          <p class="my-4 text-gray-600 font-light hidden lg:block">
            æ–‡ç« ç›®å½•
          </p>
          <div class="toc-container hidden lg:block">
            <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-%E5%89%8D%E8%A8%80">1 å‰è¨€</a></li>
<li><a href="#21-spring-%E6%A0%87%E5%87%86%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86">2.1 Spring æ ‡å‡†äº‹ä»¶å¤„ç†</a>
<ul>
<li><a href="#211-%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8%E7%9A%84%E4%BA%8B%E4%BB%B6%E4%BE%A6%E5%90%AC">2.1.1 æ³¨è§£é©±åŠ¨çš„äº‹ä»¶ä¾¦å¬</a>
<ul>
<li><a href="#%E5%BC%95%E5%85%A5-eventlistener">å¼•å…¥ @EventListener</a></li>
<li><a href="#%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BC%A0%E9%80%92">äº‹ä»¶çš„ä¼ é€’</a></li>
</ul>
</li>
<li><a href="#212-%E4%BE%A6%E5%90%AC%E5%99%A8%E4%BC%98%E5%85%88%E7%BA%A7">2.1.2 ä¾¦å¬å™¨ä¼˜å…ˆçº§</a></li>
</ul>
</li>
<li><a href="#22-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6">2.2 è‡ªå®šä¹‰äº‹ä»¶</a>
<ul>
<li><a href="#221-%E8%87%AA%E5%AE%9A%E4%B9%89-application-event">2.2.1 è‡ªå®šä¹‰ <strong>Application</strong> Event</a></li>
<li><a href="#222-%E8%87%AA%E5%AE%9A%E4%B9%89-publisher">2.2.2 è‡ªå®šä¹‰ Publisher</a></li>
<li><a href="#223-%E8%87%AA%E5%AE%9A%E4%B9%89-listener">2.2.3 è‡ªå®šä¹‰ Listener</a></li>
<li><a href="#224-%E5%BC%82%E6%AD%A5%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86">2.2.4 å¼‚æ­¥äº‹ä»¶å¤„ç†</a></li>
</ul>
</li>
<li><a href="#23-spring-boot-%E4%BA%8B%E4%BB%B6%E4%B8%8E%E4%BE%A6%E5%90%AC">2.3 Spring Boot äº‹ä»¶ä¸ä¾¦å¬</a></li>
<li><a href="#3-%E7%BB%93%E8%AF%AD">3 ç»“è¯­</a></li>
<li><a href="#4-%E5%8F%82%E8%80%83">4 å‚è€ƒ</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      
    </div>
  </div>
</div>

<div class="menu-container">
  <i class="remixicon-arrow-left-line text-2xl cursor-pointer animated fadeIn close-menu-btn" onclick="closeMenu()"></i>
  <div>
    
      
        <a href="/" class="menu" style="animation-delay: 0s">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu" style="animation-delay: 0.2s">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu" style="animation-delay: 0.4s">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu" style="animation-delay: 0.6000000000000001s">
          å…³äº
        </a>
      
    
  </div>
  <div class="site-footer">
    <div class="py-4 text-gray-700"></div>
    <a class="rss" href="https://wrcj12138aaa.github.io//atom.xml" target="_blank">RSS</a>
  </div>
</div>
<div class="mask" onclick="closeMenu()">
</div>
      <div class="content-wrapper py-32 lg:p-8 lg:w-3/4 post-detail animated fadeIn">
        <h1 class="text-3xl font-bold lg:mt-16">ä¸€èµ·å­¦Springä¹‹äº‹ä»¶å¤„ç†</h1>
        <div class="text-sm text-gray-700 lg:my-8">
          2019-05-26 / 12 min read
        </div>
        
        <div class="post-content yue">
          <figure data-type="image" tabindex="1"><img src="http://ww1.sinaimg.cn/large/006tNc79ly1g3eyykzk1lj30p00dwq4p.jpg" alt=""></figure>
<h2 id="1-å‰è¨€">1 å‰è¨€</h2>
<p>æœ¬æ¬¡æˆ‘ä»¬æ¥å­¦ä¹  Spring çš„äº‹ä»¶å¤„ç†ï¼Œæºäºå®é™…å·¥ä½œä¸­é‡åˆ°çš„é¡¹ç›®éœ€æ±‚ï¼šåœ¨ä¸€ä¸ªæ”¯ä»˜çš„ä¸‹å•åœºæ™¯ä¸­ï¼Œå½“ç”¨æˆ·çœŸæ­£æ”¯ä»˜æˆåŠŸï¼ŒæœåŠ¡å™¨æ”¶åˆ°å›è°ƒåå°±éœ€è¦åŠæ—¶æ›´æ–°è®¢å•æ•°æ®çŠ¶æ€æ¥ä¿è¯æ•°æ®ä¸€è‡´ã€‚é€šå¸¸åšæ³•å°±æ˜¯åœ¨å›è°ƒæ–¹æ³•é‡Œç›´æ¥ä½¿ç”¨è®¢å•æœåŠ¡æ›´æ–°æ•°æ®ï¼Œ ç„¶è€Œè¿™æ ·å®ç°ä¸Šä¸¤ä¸ªæ¨¡å—å‡ºç°äº†ç´§å¯†è€¦åˆï¼Œå¦‚æœè®¢å•æ›´æ–°çš„æ“ä½œéœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œé‚£ä¹ˆåœ¨æ”¯ä»˜å›è°ƒçš„ä»£ç å—ä¸­ä¹Ÿéœ€è¦è¢«ä¿®æ”¹ã€‚</p>
<p>ä¸ºäº†é¿å…è¿™æ ·æƒ…å†µå‘ç”Ÿï¼Œæˆ‘é‡‡ç”¨äº† Spring äº‹ä»¶å‘å¸ƒä¸è®¢é˜…çš„æ–¹å¼æ¥å®ç°æ¥å—æ”¯ä»˜å›è°ƒï¼Œå‘å¸ƒé€šçŸ¥æ›´æ–°è®¢å•çŠ¶æ€çš„è¿™ä¸ªåŠŸèƒ½ï¼Œè®©è®¢å•æœåŠ¡æ›´æ–°æ•°æ®çš„æ“ä½œåªä¾èµ–ç‰¹å®šçš„äº‹ä»¶ï¼Œè€Œä¸ç”¨å…³å¿ƒå…·ä½“çš„è§¦å‘å¯¹è±¡ï¼Œä¹Ÿèƒ½è¾¾åˆ°ä»£ç å¤ç”¨çš„ç›®çš„ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦å†…å®¹æ¶‰åŠå¦‚ä¸‹ï¼š</p>
<ul>
<li>Spring æ ‡å‡†äº‹ä»¶çš„å¤„ç†</li>
<li>Spring ä¸­è‡ªå®šä¹‰äº‹ä»¶æ‰©å±•å®ç°</li>
<li>Spring Boot çš„äº‹ä»¶ä¸ä¾¦å¬</li>
</ul>
<blockquote>
<p>ç¤ºä¾‹é¡¹ç›®ï¼š</p>
<ul>
<li>spring-eventsï¼šhttps://github.com/wrcj12138aaa/spring-events</li>
</ul>
<p>ç¯å¢ƒæ”¯æŒï¼š</p>
<ul>
<li>JDK 8</li>
<li>SpringBoot 2.1.4</li>
<li>Maven 3.6.0</li>
</ul>
</blockquote>
<h2 id="21-spring-æ ‡å‡†äº‹ä»¶å¤„ç†">2.1 Spring æ ‡å‡†äº‹ä»¶å¤„ç†</h2>
<p>Spring ç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­ä¼šæœ‰ä¸åŒçš„äº‹ä»¶é€šçŸ¥ï¼Œå†…ç½®æ ‡å‡†çš„äº‹ä»¶æœ‰ 5 ç§ï¼š</p>
<table>
<thead>
<tr>
<th>äº‹ä»¶</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ContextRefreshedEvent</code></td>
<td>å½“ Spring å®¹å™¨å¤„äºåˆå§‹åŒ–æˆ–è€…åˆ·æ–°é˜¶æ®µæ—¶å°±ä¼šè§¦å‘ï¼Œäº‹å®æ˜¯<code>ApplicationContext#refresh()</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ­¤æ—¶å®¹å™¨å·²ç»åˆå§‹åŒ–å®Œæ¯•ã€‚</td>
</tr>
<tr>
<td><code>ContextStartedEvent</code></td>
<td>å½“è°ƒç”¨ <code>ConfigurableApplicationContext</code>æ¥å£ä¸‹çš„ <code>start()</code> æ–¹æ³•æ—¶è§¦å‘ï¼Œè¡¨ç¤º Spring å®¹å™¨å¯åŠ¨ï¼›é€šå¸¸ç”¨äº Spring å®¹å™¨æ˜¾å¼å…³é—­åçš„å¯åŠ¨ã€‚</td>
</tr>
<tr>
<td><code>ContextStoppedEvent</code></td>
<td>å½“è°ƒç”¨ <code>ConfigurableApplicationContext</code> æ¥å£ä¸‹çš„ <code>stop()</code>æ–¹æ³•æ—¶è§¦å‘ï¼Œè¡¨ç¤º Spring å®¹å™¨åœæ­¢ï¼Œæ­¤æ—¶èƒ½é€šè¿‡å…¶ <code>start()</code>æ–¹æ³•é‡å¯å®¹å™¨ã€‚</td>
</tr>
<tr>
<td><code>ContextClosedEvent</code></td>
<td>å½“ Spring å®¹å™¨è°ƒç”¨ <code>ApplicationContext#close()</code> æ–¹æ³•æ—¶è§¦å‘ï¼Œæ­¤æ—¶ Spring çš„ beans éƒ½å·²ç»è¢«é”€æ¯ï¼Œå¹¶ä¸”ä¸ä¼šé‡æ–°å¯åŠ¨å’Œåˆ·æ–°ã€‚</td>
</tr>
<tr>
<td><code>RequestHandledEvent</code></td>
<td>åªåœ¨ Web åº”ç”¨ä¸‹å­˜åœ¨ï¼Œå½“æ¥å—åˆ° HTTP è¯·æ±‚å¹¶å¤„ç†åå°±ä¼šè§¦å‘ï¼Œå®é™…ä¼ é€’çš„é»˜è®¤å®ç°ç±» <code>ServletRequestHandledEvent</code></td>
</tr>
</tbody>
</table>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒSpring ç¨‹åºéƒ½ä¼šæ¥æ”¶åˆ° <code>ContextRefreshedEvent</code>, <code>ContextClosedEvent</code> äº‹ä»¶çš„é€šçŸ¥ã€‚</p>
<p>çŸ¥é“äº† Spring è‡ªå¸¦çš„äº‹ä»¶æœ‰å“ªäº›åï¼Œæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹ä¸€äº›åœºæ™¯åˆ©ç”¨äº‹ä»¶æœºåˆ¶æ¥å®ç°éœ€æ±‚ï¼Œæ¯”å¦‚è¯´åœ¨ Spring å¯åŠ¨ååˆå§‹åŒ–èµ„æºï¼ŒåŠ è½½ç¼“å­˜æ•°æ®åˆ°å†…å­˜ä¸­ç­‰ç­‰ã€‚ä»£ç å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@Component
public class InitalizeListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; {
    @Override
    public void onApplicationEvent(ContextRefreshedEvent event) {
        ApplicationContext applicationContext = event.getApplicationContext();
        System.out.println(&quot;Spring å®¹å™¨å¯åŠ¨  è·å–åˆ° Application Context å¯¹è±¡ &quot; + applicationContext);
        //TODO åˆå§‹åŒ–èµ„æºï¼ŒåŠ è½½ç¼“å­˜æ•°æ®åˆ°å†…å­˜
    }
}

// å¯åŠ¨ Spring ç¨‹åºåï¼Œæ§åˆ¶å°å‡ºç°å¦‚ä¸‹æ—¥å¿—ï¼š
// Spring å®¹å™¨å¯åŠ¨  è·å–åˆ° Application Context å¯¹è±¡ org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@6950ed69, started on Sun May 26 12:19:33 CST 2019
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥ä» <code>ContextRefreshedEvent</code> äº‹ä»¶ä¸­è·å–åˆ° <code>ApplicationContext</code> å¯¹è±¡ï¼Œä»è€Œè·å– Spring å®¹å™¨ä¸­ä»»ä½•å·²ç»è£…è½½çš„ Bean è¿›è¡Œè‡ªå®šä¹‰çš„æ“ä½œã€‚</p>
<h3 id="211-æ³¨è§£é©±åŠ¨çš„äº‹ä»¶ä¾¦å¬">2.1.1 æ³¨è§£é©±åŠ¨çš„äº‹ä»¶ä¾¦å¬</h3>
<h4 id="å¼•å…¥-eventlistener">å¼•å…¥ @EventListener</h4>
<p>ä» Spring 4.2 å¼€å§‹ï¼ŒSpring åˆæä¾›äº†æ›´çµæ´»çš„ï¼Œæ³¨è§£é©±åŠ¨çš„äº‹ä»¶ä¾¦å¬å¤„ç†æ–¹å¼ã€‚ä¸»è¦ä½¿ç”¨ <code>@EventListener</code> æ³¨è§£æ¥æ ‡è®°éœ€è¦ç›‘å¬ç¨‹åºäº‹ä»¶çš„æ–¹æ³•ï¼Œåº•å±‚ç”± <code>EventListenerMethodProcessor</code> å¯¹è±¡å°†æ ‡æ³¨çš„æ–¹æ³•è½¬ä¸ºæˆ <code>ApplicationListener</code> å®ä¾‹ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¯´è¿™ä¸ªæ³¨è§£æ–¹å¼ä¾¦å¬äº‹ä»¶æ›´åŠ çµæ´»å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸‹ <code>@EventListener</code> æ³¨è§£çš„æºç ã€‚</p>
<pre><code class="language-java">@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface EventListener {

    @AliasFor(&quot;classes&quot;)
    Class&lt;?&gt;[] value() default {};

    @AliasFor(&quot;value&quot;)
    Class&lt;?&gt;[] classes() default {};

    String condition() default &quot;&quot;;
}
</code></pre>
<p><code>EventListener</code> æ³¨è§£ä¸»è¦æœ‰ä¸¤ä¸ªå±æ€§ï¼š<code>classes</code> å’Œ <code>condition</code>ã€‚ <code>classes</code> è¡¨ç¤ºæ‰€éœ€è¦ä¾¦å¬çš„äº‹ä»¶ç±»å‹ï¼Œæ˜¯ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥å…è®¸åœ¨å•ä¸ªæ–¹æ³•é‡Œè¿›è¡Œå¤šä¸ªä¸åŒäº‹ä»¶çš„ä¾¦å¬ï¼Œä»¥æ­¤åšåˆ°å¤ç”¨çš„æ•ˆæœï¼›<code>condition</code> é¡¾åæ€ä¹‰å°±æ˜¯ç”¨æ¥å®šä¹‰æ‰€ä¾¦å¬äº‹ä»¶æ˜¯å¦å¤„ç†çš„å‰ç½®æ¡ä»¶ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ä½¿ç”¨ <a href="https://docs.spring.io/spring/docs/4.3.10.RELEASE/spring-framework-reference/html/expressions.html">Spring Expression Language</a> ï¼ˆSpELï¼‰å®šä¹‰æ¡ä»¶ï¼Œæ¯”å¦‚ <code>#root.event</code> è¡¨ç¤ºäº†å…·ä½“çš„ <code>ApplicationEvent</code>å¯¹è±¡, ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒä¸‹æ–¹ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="language-java">@Component
public class AnnotationListener {

    @EventListener(value = {ContextRefreshedEvent.class, ContextStartedEvent.class, ContextStoppedEvent.class, ContextClosedEvent.class, RequestHandledEvent.class}, condition = &quot;#root.event != null&quot;)
    public void listener(ApplicationEvent event) {
        System.out.println(Thread.currentThread() + &quot; æ¥æ”¶åˆ° Spring äº‹ä»¶ï¼š&quot; + event);
    }
}
</code></pre>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ³¨è§£ <code>@EventListener</code>æ ‡è®°çš„æ–¹æ³•å‚æ•°ç±»å‹ä¸å†é™åˆ¶å¿…é¡»æ˜¯ <code>ApplicationEvent</code>çš„å­ç±»ï¼Œæ²¡æœ‰å®ç° <code>ApplicationListener</code> æ¥å£æ–¹æ³•çš„çº¦æŸï¼Œä¹Ÿè®©äº‹ä»¶å˜å¾—æ›´åŠ çµæ´»ã€‚</p>
<h4 id="äº‹ä»¶çš„ä¼ é€’">äº‹ä»¶çš„ä¼ é€’</h4>
<p>å¦å¤–ï¼Œä½¿ç”¨ <code>@EventListener</code> è¿˜æ”¯æŒäº‹ä»¶çš„ä¼ é€’ï¼Œå°†å½“å‰äº‹ä»¶å¤„ç†å¥½çš„ç»“æœå°è£…åå‘å¸ƒä¸€ä¸ªæ–°çš„äº‹ä»¶ï¼Œå®ç°çš„æ–¹å¼å°±æ˜¯è®©ä¾¦å¬æ–¹æ³•è¿”å›é <code>null</code> å€¼æ—¶ï¼Œå°±è§†ä¸ºäº‹ä»¶ç»§ç»­ä¼ æ’­,å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="language-java">@Component
@Order(2)
public class CustomEventListener {
    @EventListener
    public SecondCustomEvent listener(CustomEvent event) {
        System.out.println(Thread.currentThread() + &quot;CustomEventListeneræ¥å—åˆ°è‡ªå®šä¹‰äº‹ä»¶ï¼š&quot; + event);
        return new SecondCustomEvent(this, event.toString());
    }
}
</code></pre>
<h3 id="212-ä¾¦å¬å™¨ä¼˜å…ˆçº§">2.1.2 ä¾¦å¬å™¨ä¼˜å…ˆçº§</h3>
<p>å½“æˆ‘ä»¬å¯¹å•ä¸ªäº‹ä»¶å­˜åœ¨å¤šä¸ªä¾¦å¬å™¨æ—¶ï¼Œå¯èƒ½ä¼šç”±äºéœ€æ±‚æƒ³è¦æŒ‡å®šä¾¦å¬å™¨çš„æ‰§è¡Œé¡ºåºï¼Œè¿™ä¸€ç‚¹ Spring ä¹Ÿä¸ºæˆ‘ä»¬è€ƒè™‘åˆ°äº†ï¼Œåªè¦ä½¿ç”¨ <code>@Order</code>æ³¨è§£å£°æ˜ç›‘å¬ç±»æˆ–è€…ç›‘å¬æ–¹æ³•å³å¯ï¼Œæ ¹æ® <code>@Order</code> çš„ <code>value</code> å¤§å°æ¥ç¡®å®šæ‰§è¡Œé¡ºåºï¼Œè¶Šå°è¶Šä¼˜å…ˆæ‰§è¡Œã€‚</p>
<pre><code class="language-java">@EventListener
@Order(42)
public void processEvent(Event event) {
}
</code></pre>
<h2 id="22-è‡ªå®šä¹‰äº‹ä»¶">2.2 è‡ªå®šä¹‰äº‹ä»¶</h2>
<p>åœ¨äº†è§£å¦‚ä½•ä¾¦å¬ Spring äº‹ä»¶åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹å¦‚ä½•å®ç°è‡ªå®šä¹‰çš„äº‹ä»¶å‘å¸ƒå’Œä¾¦å¬å¤„ç†ã€‚é¦–å…ˆå°±è¦ä»‹ç» Spring ä¸­äº‹ä»¶æœºåˆ¶çš„ä¸‰ç±»å¯¹è±¡ï¼š</p>
<ul>
<li><code>Event</code> ï¼šæ‰€éœ€è¦è§¦å‘çš„å…·ä½“äº‹ä»¶å¯¹è±¡ï¼Œé€šå¸¸æ‰©å±• <code>ApplicationEvent</code> å®ç°ã€‚</li>
<li><code>Publisher</code>ï¼šè§¦å‘äº‹ä»¶å‘å¸ƒçš„å¯¹è±¡ï¼ŒSpring æä¾›äº† <code>ApplicationEventPublisher</code> å¯¹è±¡ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œä½¿ç”¨å®ƒçš„<code>publishEvent()</code> æ–¹æ³•å°±å¯ä»¥å‘å¸ƒè¯¥äº‹ä»¶ã€‚</li>
<li><code>Listener</code>ï¼šä¾¦å¬äº‹ä»¶å‘ç”Ÿçš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ¥å—å›è°ƒè¿›è¡Œå¤„ç†çš„åœ°æ–¹ï¼Œå¯ä»¥é€šè¿‡ å®ç° <code>ApplicationListener</code>æ¥å£ï¼Œæˆ–è€…ä½¿ç”¨å‰é¢æåˆ°çš„ <code>@EventListener</code>æ³¨è§£å£°æ˜ä¸ºäº‹ä»¶çš„ä¾¦å¬å™¨ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥å°±ç®€å•çœ‹ä¸‹ï¼Œä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ä»å£°æ˜åˆ°å‘å¸ƒè®¢é˜…çš„ä»£ç ç¤ºä¾‹ã€‚</p>
<h3 id="221-è‡ªå®šä¹‰-application-event">2.2.1 è‡ªå®šä¹‰ <strong>Application</strong> Event</h3>
<pre><code class="language-java">public class CustomEvent extends ApplicationEvent {
    private String data;

    public CustomEvent(Object source, String data) {
        super(source);
        this.data = data;
    }

    public String getData() {
        return data;
    }

    public void setData(String data) {
        this.data = data;
    }

    @Override
    public String toString() {
        return &quot;CustomEvent{&quot; +
                &quot;data='&quot; + data + '\'' +
                &quot;, source=&quot; + source +
                '}';
    }
}
</code></pre>
<h3 id="222-è‡ªå®šä¹‰-publisher">2.2.2 è‡ªå®šä¹‰ Publisher</h3>
<pre><code class="language-java">@Component
public class CustomeEventPublisher implements ApplicationEventPublisherAware {
    private ApplicationEventPublisher applicationEventPublisher;

    @Override
    public void setApplicationEventPublisher(ApplicationEventPublisher applicationEventPublisher) {
        this.applicationEventPublisher = applicationEventPublisher;
    }

    public void publishEvent(String message) {
        System.out.println(&quot;å¼€å§‹å‘å¸ƒäº‹ä»¶ &quot; + message);
        applicationEventPublisher.publishEvent(new CustomEvent(this, message));
    }
}
</code></pre>
<p>åˆ›å»ºäº‹ä»¶å‘å¸ƒè€…æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ <code>@Autowire</code>æ³¨è§£ï¼Œé€šè¿‡ Spring å®¹å™¨çš„ä¾èµ–æ³¨å…¥åŠŸèƒ½ï¼Œç›´æ¥æ³¨å…¥ <code>ApplicationEventPublisher</code>å¯¹è±¡ï¼Œæˆ–è€…å®ç° <code>ApplicationEventPublisherAware</code>æ¥å£ï¼Œåœ¨ Spring å®¹å™¨å¯åŠ¨æ—¶ç”± Spring è®¾ç½®ã€‚</p>
<h3 id="223-è‡ªå®šä¹‰-listener">2.2.3 è‡ªå®šä¹‰ Listener</h3>
<pre><code class="language-java">@Component
public class CustomEventListener implements ApplicationListener&lt;CustomEvent&gt; {
    @Override
    public void onApplicationEvent(CustomEvent event) {
        System.out.println(Thread.currentThread()+&quot;CustomEventListeneræ¥å—åˆ°è‡ªå®šä¹‰äº‹ä»¶ï¼š&quot; + event);
    }
}
</code></pre>
<p>å®šä¹‰äº‹ä»¶ä¾¦å¬å™¨æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡å®ç° <code>ApplicationListener</code> æ¥å£ï¼ŒæŒ‡å®šäº†äº‹ä»¶ç±»å‹ï¼Œè¿™æ ·åœ¨å¤„ç†äº‹ä»¶æ—¶å°±ä¸é¿å…äº†äº‹ä»¶ç±»å‹åˆ¤æ–­å’Œè½¬æ¢ã€‚</p>
<p>å…³äºäº‹ä»¶ä¾¦å¬å™¨è¿˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šSpring äº‹ä»¶å¤„ç†é»˜è®¤æ˜¯åŒæ­¥çš„ï¼Œè¿™ä¸€ç‚¹åœ¨ Spring å®˜æ–¹æ–‡æ¡£æ‰€æœ‰æåŠï¼Œæˆ‘ä»¬å…ˆè§£è¯»ä¸‹å®˜æ–¹æè¿°ï¼š</p>
<blockquote>
<p>You can register as many event listeners as you wish, but note that, by default, event listeners receive events synchronously. This means that the <code>publishEvent()</code> method blocks until all listeners have finished processing the event. One advantage of this synchronous and single-threaded approach is that, when a listener receives an event, it operates inside the transaction context of the publisher if a transaction context is available. If another strategy for event publication becomes necessary, See the javadoc for Springâ€™s <a href="https://docs.spring.io/spring-framework/docs/5.1.6.RELEASE/javadoc-api/org/springframework/context/event/ApplicationEventMulticaster.html"><code>ApplicationEventMulticaster</code></a> interface.</p>
</blockquote>
<p>å½“å‘å¸ƒè€…æ‰§è¡Œäº† <code>publishEvent()</code> æ–¹æ³•ï¼Œé»˜è®¤æƒ…å†µä¸‹æ–¹æ³•æ‰€åœ¨çš„å½“å‰çº¿ç¨‹å°±ä¼šé˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰è¯¥äº‹ä»¶ç›¸å…³çš„ä¾¦å¬å™¨å°†äº‹ä»¶å¤„ç†å®Œæˆã€‚è€Œè¿™æ ·é‡‡ç”¨å•çº¿ç¨‹åŒæ­¥æ–¹å¼å¤„ç†çš„å¥½å¤„ä¸»è¦æ˜¯å¯ä»¥ä¿è¯è®©äº‹ä»¶å¤„ç†ä¸å‘å¸ƒè€…å¤„äºåŒä¸€ä¸ªäº‹åŠ¡ç¯å¢ƒé‡Œï¼Œå¦‚æœå¤šä¸ªä¾¦å¬æ–¹æ³•æ¶‰åŠåˆ°æ•°æ®åº“æ“ä½œæ—¶ä¿è¯äº†äº‹åŠ¡çš„å­˜åœ¨ã€‚</p>
<h3 id="224-å¼‚æ­¥äº‹ä»¶å¤„ç†">2.2.4 å¼‚æ­¥äº‹ä»¶å¤„ç†</h3>
<p>å½“ç„¶ Spring ä¹Ÿæä¾›äº†å¼‚æ­¥ä¾¦å¬äº‹ä»¶çš„æ–¹å¼ï¼Œè¿™é‡Œä¸»è¦ä¾èµ– <code>ApplicationEventMulticaster</code>æ¥å£,å¯ä»¥ç†è§£ä¸ºå¹¿æ’­æ–¹å¼ï¼Œä¸ºäº†ä¾¿äºä½¿ç”¨ï¼ŒSpring æä¾›ä¸€ä¸ªç®€æ˜“çš„å®ç°ç±» <code>SimpleApplicationEventMulticaster</code> ä¾›æˆ‘ä»¬ç›´æ¥ä½¿ç”¨,åªéœ€è¦å°†è¿™ä¸ªå¯¹è±¡æ³¨å†Œåˆ° Spring å®¹å™¨å³å¯ã€‚</p>
<pre><code class="language-java">@Configuration
public class AsynchronousSpringEventsConfig {
    @Bean(name = &quot;applicationEventMulticaster&quot;)
    public ApplicationEventMulticaster simpleApplicationEventMulticaster() {
        SimpleApplicationEventMulticaster eventMulticaster
                = new SimpleApplicationEventMulticaster();
        eventMulticaster.setTaskExecutor(new SimpleAsyncTaskExecutor());
        return eventMulticaster;
    }
}
</code></pre>
<p>è¿™é‡Œ <code>ApplicationEventMulticaster</code>Bean éœ€è¦ä¸€ä¸ª <code>java.util.concurrent.Executor</code>å¯¹è±¡ä½œä¸ºäº‹ä»¶å¤„ç†çš„çº¿ç¨‹æ± ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ Spring æä¾›çš„ <code>SimpleAsyncTaskExecutor</code> å¯¹è±¡ï¼Œæ¯æ¬¡äº‹ä»¶å¤„ç†éƒ½ä¼šæœ‰åˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæ³¨å†Œ <code>ApplicationEventMulticaster</code> Bean åæ‰€æœ‰çš„äº‹ä»¶ä¾¦å¬å¤„ç†éƒ½ä¼šå˜æˆçš„å¼‚æ­¥å½¢å¼ï¼Œå¦‚æœéœ€è¦é’ˆå¯¹ç‰¹å®šçš„äº‹ä»¶ä¾¦å¬é‡‡ç”¨å¼‚æ­¥æ–¹å¼çš„è¯ï¼šå¯ä»¥ä½¿ç”¨ <code>@EventListener</code> å’Œ<code>@Async</code> ç»„åˆæ¥å®ç°ã€‚(å‰ææ˜¯ Spring ç¨‹åºå¯ç”¨ <code>@EnableAsync</code> æ³¨è§£)</p>
</blockquote>
<p>è¿™é‡Œå†æä¸‹ä½¿ç”¨å¼‚æ­¥æ–¹å¼å¤„ç†äº‹ä»¶çš„åˆ©å¼Šï¼Œå¥½å¤„åœ¨äºè®©æˆ‘ä»¬ç¨‹åºåœ¨å¤„ç†äº‹ä»¶æ›´åŠ æœ‰æ•ˆç‡ï¼Œè€Œç¼ºç‚¹å°±åœ¨é’ˆå¯¹å¼‚å¸¸å‘ç”Ÿçš„å¤„ç†æ›´åŠ å¤æ‚ï¼Œéœ€è¦å€ŸåŠ© <code>AsyncUncaughtExceptionHandler</code>æ¥å£å®ç°ã€‚</p>
<h2 id="23-spring-boot-äº‹ä»¶ä¸ä¾¦å¬">2.3 Spring Boot äº‹ä»¶ä¸ä¾¦å¬</h2>
<p>å­¦ä¹ äº†é‚£ä¹ˆå¤š Spring Framework çš„äº‹ä»¶å¤„ç†ç›¸å…³çš„å†…å®¹åï¼Œæˆ‘ä»¬ç°åœ¨å†æ¥çœ‹çœ‹åœ¨ Spring Boot é‡Œäº‹ä»¶å¤„ç†æœ‰ä»€ä¹ˆéœ€è¦é¢å¤–å­¦ä¹ çš„åœ°æ–¹ã€‚è¿˜æ˜¯ä¸€æ ·ï¼Œæˆ‘ä»¬å…ˆä» Spring Boot å®˜æ–¹æ–‡æ¡£ä¸‹æ‰‹ï¼Œåœ¨ Spring Boot</p>
<p>Doc çš„ <a href="https://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/reference/htmlsingle/#boot-features-application-events-and-listeners">23.5 Application Events and Listeners</a> ä¸€èŠ‚ä¸­æåˆ°äº†äº‹ä»¶å¤„ç†:</p>
<blockquote>
<ul>
<li>
<p>In addition to the usual Spring Framework events, such as <a href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/javadoc-api/org/springframework/context/event/ContextRefreshedEvent.html"><code>ContextRefreshedEvent</code></a>, a <code>SpringApplication</code> sends some additional application events.</p>
</li>
<li>
<p>Application events are sent by using Spring Frameworkâ€™s event publishing mechanism.</p>
</li>
</ul>
</blockquote>
<p>å¯ä»¥çœ‹å‡º Spring Boot ä»æ˜¯åŸºäº Spring Framework çš„äº‹ä»¶å‘å¸ƒæœºåˆ¶å»å¤„ç†äº‹ä»¶ï¼Œåªæ˜¯åœ¨æ­¤åŸºç¡€äº†æ–°å¢äº†å‡ ä¸ª <code>SpringApplication</code> ç›¸å…³çš„äº‹ä»¶ï¼š</p>
<ul>
<li><code>ApplicationStartingEvent</code> ï¼šç¨‹åºå¯åŠ¨æ—¶å‘ç”Ÿã€‚</li>
<li><code>ApplicationEnvironmentPreparedEvent</code> ï¼šç¨‹åºä¸­<code>Environment</code> å¯¹è±¡å°±ç»ªæ—¶å‘ç”Ÿã€‚</li>
<li><code>ApplicationPreparedEvent</code> ï¼šç¨‹åºå¯åŠ¨åä½†è¿˜æœªåˆ·æ–°æ—¶å‘ç”Ÿã€‚</li>
<li><code>ApplicationStartedEvent</code>ï¼šç¨‹åºå¯åŠ¨åˆ·æ–°åå‘ç”Ÿã€‚</li>
<li><code>ApplicationReadyEvent</code>ï¼šç¨‹åºå¯åŠ¨å®Œæ¯•ï¼Œç­‰å¾…è¯·æ±‚æ—¶å‘ç”Ÿã€‚</li>
<li><code>ApplicationFailedEvent</code> ï¼šç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸æ—¶å‘ç”Ÿã€‚</li>
</ul>
<p>å¹¶ä¸”å®ƒä»¬çš„æ‰§è¡Œé¡ºåºä¹Ÿæ˜¯åˆ—ä¸¾ä¹¦é¡ºåºä¾æ¬¡è§¦å‘çš„ã€‚</p>
<p>å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“éœ€è¦è§¦å‘çš„äº‹ä»¶æ˜¯åœ¨ <code>ApplicationContext</code> åˆ›å»ºä¹‹å‰å‘ç”Ÿæ—¶ï¼Œç”¨ <code>@Bean</code> æ–¹å¼æ³¨å†Œçš„ä¾¦å¬å™¨å°±ä¸ä¼šæ‰§è¡Œï¼Œè€Œ Spring Boot ä¸ºæ­¤æä¾›äº†ä¸‰ç§æ–¹å¼æ¥å¤„ç†è¿™ç§æƒ…å†µï¼š</p>
<ol>
<li>
<p>ä½¿ç”¨ <code>SpringApplication.addListeners(â€¦)</code> æ–¹æ³•æ³¨å†Œä¾¦å¬å™¨</p>
<pre><code class="language-java">SpringApplication springApplication = new SpringApplication(SpringEventsApplication.class);
springApplication.addListeners(new NormalCustomEventListener());
springApplication.run(args);
</code></pre>
</li>
<li>
<p>ä½¿ç”¨ <code>SpringApplicationBuilder.listeners(â€¦)</code>æ–¹æ³•æ³¨å†Œä¾¦å¬å™¨</p>
<pre><code class="language-java">SpringApplicationBuilder springApplicationBuilder = new SpringApplicationBuilder(SpringEventsApplication.class);
springApplicationBuilder.listeners(new NormalCustomEventListener()).run(args);
</code></pre>
</li>
<li>
<p>åœ¨åº”ç”¨èµ„æºæ–‡ä»¶å¤¹æ–°å»ºæ–‡ä»¶ <code>META-INF/spring.factories</code>ï¼Œå¹¶å°† <code>org.springframework.context.ApplicationListener</code> ä½œä¸ºé”®ï¼ŒæŒ‡å®šéœ€è¦æ³¨å†Œçš„ä¾¦å¬å™¨ç±»ï¼Œå¦‚:</p>
<pre><code class="language-properties">org.springframework.context.ApplicationListener=\
com.one.learn.spring.springevents.listener.NormalSecondCutomEventListener
</code></pre>
</li>
</ol>
<h2 id="3-ç»“è¯­">3 ç»“è¯­</h2>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬å­¦ä¹  Spring äº‹ä»¶ç›¸å…³çš„å†…å®¹å°±ç»“æŸäº†ï¼Œäº†è§£ Spring çš„äº‹ä»¶æœºåˆ¶ï¼Œå¹¶é€‚å½“åº”ç”¨ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬å®Œæˆç¨‹åºçš„æŸä¸ªåŠŸèƒ½æ—¶æä¾›ä¸€ä¸ªæ›´åŠ è§£è€¦ï¼Œçµæ´»çš„å®ç°æ–¹å¼ã€‚</p>
<p>å¦‚æœè¯»å®Œè§‰å¾—æœ‰æ”¶è·çš„è¯ï¼Œæ¬¢è¿ç‚¹ã€å¥½çœ‹ã€‘ï¼Œç‚¹å‡»æ–‡ç« å¤´å›¾ï¼Œæ‰«ç å…³æ³¨ã€é—»äººçš„æŠ€æœ¯åšå®¢ã€‘ğŸ˜„ğŸ˜„ğŸ˜„ã€‚</p>
<h2 id="4-å‚è€ƒ">4 å‚è€ƒ</h2>
<p>Spring context-functionality-events: https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/core.html#context-functionality-events</p>
<p>Spring boot-features-application-events-and-listenersï¼šhttps://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/reference/htmlsingle/#boot-features-application-events-and-listeners</p>
<p>Spring Expression Language: https://docs.spring.io/spring/docs/4.3.10.RELEASE/spring-framework-reference/html/expressions.html</p>
<p>SpringEvents: https://www.baeldung.com/spring-events</p>
<p>Better application events in Spring Framework 4.2: https://spring.io/blog/2015/02/11/better-application-events-in-spring-framework-4-2</p>

        </div>

        
          <a class="animated fadeInUp p-2 items-center text-sm text-gray-700 border hover:bg-gray-300 leading-none rounded-full flex lg:inline-flex m-4 " href="https://wrcj12138aaa.github.io//tag/VSWLYuWEZR">
            <span class="flex-auto">Spring</span>
          </a>
        


        <div class="flex justify-between py-8">
          
            <div class="prev-post">
              <a href="https://wrcj12138aaa.github.io//post/20190602-Javaå¿…å¤‡ä¹‹Lombokå¿…çŸ¥å¿…ä¼š">
                <h3 class="post-title">
                  <i class="remixicon-arrow-left-line"></i>
                  Javaå¿…å¤‡ä¹‹Lombokå¿…çŸ¥å¿…ä¼š
                </h3>
              </a>
            </div>
          

          
            <div class="next-post">
              <a href="https://wrcj12138aaa.github.io//post/20190518-ä¸€èµ·å­¦ Spring ä¹‹å¼‚å¸¸å¤„ç†">
                <h3 class="post-title">
                  ä¸€èµ·å­¦ Spring ä¹‹ å¼‚å¸¸å¤„ç†
                  <i class="remixicon-arrow-right-line"></i>
                </h3>
              </a>
            </div>
          
        </div>

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '2ba76d6fe50ad2b384eb',
    clientSecret: '90db763ed48942571725d6aef11229900c8bb656',
    repo: 'wrcj12138aaa.github.io',
    owner: 'wrcj12138aaa',
    admin: ['wrcj12138aaa'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

      </div>
    </div>

    <script src="https://wrcj12138aaa.github.io//media/prism.js"></script>  
<script>

Prism.highlightAll()

let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

// This should probably be throttled.
// Especially because it triggers during smooth scrolling.
// https://lodash.com/docs/4.17.10#throttle
// You could do like...
// window.addEventListener("scroll", () => {
//    _.throttle(doThatStuff, 100);
// });
// Only not doing it here to keep this Pen dependency-free.

window.addEventListener("scroll", event => {
  let fromTop = window.scrollY;

  mainNavLinks.forEach((link, index) => {
    let section = document.getElementById(decodeURI(link.hash).substring(1));
    let nextSection = null
    if (mainNavLinks[index + 1]) {
      nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
    }
    if (section.offsetTop <= fromTop) {
      if (nextSection) {
        if (nextSection.offsetTop > fromTop) {
          link.classList.add("current");
        } else {
          link.classList.remove("current");    
        }
      } else {
        link.classList.add("current");
      }
    } else {
      link.classList.remove("current");
    }
  });
});


document.addEventListener("DOMContentLoaded", function() {
  var lazyImages = [].slice.call(document.querySelectorAll(".post-feature-image.lazy"));

  if ("IntersectionObserver" in window) {
    let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          let lazyImage = entry.target
          lazyImage.style.backgroundImage = `url(${lazyImage.dataset.bg})`
          lazyImage.classList.remove("lazy")
          lazyImageObserver.unobserve(lazyImage)
        }
      });
    });

    lazyImages.forEach(function(lazyImage) {
      lazyImageObserver.observe(lazyImage)
    })
  } else {
    // Possibly fall back to a more compatible method here
  }
});

const menuContainer = document.querySelector('.menu-container')
const menus = document.querySelectorAll('.menu-container .menu')
const mask = document.querySelector('.mask')
const contentWrapper = document.querySelector('.content-wrapper')
const latestArticle = document.querySelector('.latest-article')
const readMore = document.querySelector('.read-more')
const indexPage = document.querySelector('.index-page')

const isHome = location.pathname === '/'
if (latestArticle) {
  latestArticle.style.display = isHome ? 'block' : 'none'
  readMore.style.display = isHome ? 'block' : 'none'
  indexPage.style.display = isHome ? 'none' : 'block'
}

const openMenu = () => {
  menuContainer.classList.add('open')
  menus.forEach(menu => {
    menu.classList.add('animated', 'fadeInLeft')
  })
  mask.classList.add('open')
  contentWrapper.classList.add('is-second')
}

const closeMenu = () => {
  menuContainer.classList.remove('open')
  menus.forEach(menu => {
    menu.classList.remove('animated', 'fadeInLeft')
  })
  mask.classList.remove('open')
  contentWrapper.classList.remove('is-second')
}
</script>
  
  </body>
</html>
